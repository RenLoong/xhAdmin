import"./vue.7d38ec30.js";import{b as Yt,n as J,r as ne,t as z,w as U,o as ie,c as oe,i as dt,m as ue,d as Y,e as y,g as Pe,f as V,h as qt,a as te,j as Wt,k as Jt,l as Kt,p as H,F as Gt,q as Xt,s as Qt,u as qe,v as Zt,x as en,y as tn,z as nn}from"./@vue.711157a1.js";/*!
 * @form-create/element-ui v3.1.27
 * (c) 2018-2024 xaboy
 * Github https://github.com/xaboy/form-create
 * Released under the MIT License.
 */function We(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),e.push.apply(e,r)}return e}function _(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?We(Object(e),!0).forEach(function(r){j(n,r,e[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):We(Object(e)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(e,r))})}return n}function K(n){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?K=function(t){return typeof t}:K=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},K(n)}function rn(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function j(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function on(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),t&&Ie(n,t)}function pe(n){return pe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},pe(n)}function Ie(n,t){return Ie=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},Ie(n,t)}function an(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function un(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function sn(n,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return un(n)}function ln(n){var t=an();return function(){var r=pe(n),i;if(t){var o=pe(this).constructor;i=Reflect.construct(r,arguments,o)}else i=r.apply(this,arguments);return sn(this,i)}}function S(n){return fn(n)||cn(n)||dn(n)||pn()}function fn(n){if(Array.isArray(n))return je(n)}function cn(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function dn(n,t){if(n){if(typeof n=="string")return je(n,t);var e=Object.prototype.toString.call(n).slice(8,-1);if(e==="Object"&&n.constructor&&(e=n.constructor.name),e==="Map"||e==="Set")return Array.from(n);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return je(n,t)}}function je(n,t){(t==null||t>n.length)&&(t=n.length);for(var e=0,r=new Array(t);e<t;e++)r[e]=n[e];return r}function pn(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function be(n,t){return Object.keys(n).reduce(function(e,r){return(!t||t.indexOf(r)===-1)&&e.push(n[r]),e},[])}var hn="fcCheckbox",mn=Y({name:hn,inheritAttrs:!1,props:{formCreateInject:Object,modelValue:{type:Array,default:function(){return[]}},type:String},emits:["update:modelValue","fc.el"],setup:function(t,e){var r=z(t.formCreateInject,"options",[]),i=z(t,"modelValue"),o=function(){return Array.isArray(r.value)?r.value:[]};return{options:o,value:i,onInput:function(u){e.emit("update:modelValue",u)}}},render:function(){var t,e,r=this,i=this.type==="button"?"ElCheckboxButton":"ElCheckbox",o=V(i);return y(V("ElCheckboxGroup"),H(this.$attrs,{modelValue:this.value,"onUpdate:modelValue":this.onInput,ref:"el"}),_({default:function(){return[r.options().map(function(u,s){var l=_({},u),f=l.value;return delete l.value,y(o,H(l,{label:f,key:i+s+"-"+u.value}),{default:function(){return[l.label||l.value||""]}})}),(t=(e=r.$slots).default)===null||t===void 0?void 0:t.call(e)]}},be(this.$slots,["default"])))},mounted:function(){this.$emit("fc.el",this.$refs.el)}});function L(n){return Array.isArray(n)?n:[null,void 0,""].indexOf(n)>-1?[]:[n]}function pt(n){n=n||new Map;var t={$on:function(r,i){var o=n.get(r),a=o&&o.push(i);a||n.set(r,[i])},$once:function(r,i){i._once=!0,t.$on(r,i)},$off:function(r,i){var o=n.get(r);o&&o.splice(o.indexOf(i)>>>0,1)},$emit:function(r){for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];(n.get(r)||[]).slice().map(function(u){u._once&&(t.$off(r,u),delete u._once),u.apply(void 0,o)}),(n.get("*")||[]).slice().map(function(u){u(r,o)})}};return t}function $e(n,t){t===void 0&&(t={});var e=t.insertAt;if(!(!n||typeof document>"u")){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",e==="top"&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=n:i.appendChild(document.createTextNode(n))}}var vn="._fc-frame ._fc-files img{display:inline-block;height:100%;vertical-align:top;width:100%}._fc-frame ._fc-upload-btn{border:1px dashed #c0ccda;cursor:pointer}._fc-frame._fc-disabled ._fc-upload-btn,._fc-frame._fc-disabled .el-button{color:#999;cursor:not-allowed!important}._fc-frame ._fc-upload-cover{background:rgba(0,0,0,.6);bottom:0;left:0;opacity:0;position:absolute;right:0;top:0;-webkit-transition:opacity .3s;-o-transition:opacity .3s;transition:opacity .3s}._fc-frame ._fc-upload-cover i{color:#fff;cursor:pointer;font-size:20px;margin:0 2px}._fc-frame ._fc-files:hover ._fc-upload-cover{opacity:1}._fc-frame .el-upload{display:block}._fc-frame ._fc-upload-icon{cursor:pointer}._fc-files,._fc-frame ._fc-upload-btn{background:#fff;border:1px solid #c0ccda;border-radius:4px;-webkit-box-shadow:2px 2px 5px rgba(0,0,0,.1);box-shadow:2px 2px 5px rgba(0,0,0,.1);-webkit-box-sizing:border-box;box-sizing:border-box;display:inline-block;height:58px;line-height:58px;margin-right:4px;overflow:hidden;position:relative;text-align:center;width:58px}";$e(vn);var ht={name:"IconCircleClose"},gn={class:"icon",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},yn=te("path",{fill:"currentColor",d:"M466.752 512l-90.496-90.496a32 32 0 0145.248-45.248L512 466.752l90.496-90.496a32 32 0 1145.248 45.248L557.248 512l90.496 90.496a32 32 0 11-45.248 45.248L512 557.248l-90.496 90.496a32 32 0 01-45.248-45.248L466.752 512z"},null,-1),_n=te("path",{fill:"currentColor",d:"M512 896a384 384 0 100-768 384 384 0 000 768zm0 64a448 448 0 110-896 448 448 0 010 896z"},null,-1),bn=[yn,_n];function $n(n,t,e,r,i,o){return ie(),oe("svg",gn,bn)}ht.render=$n;var mt={name:"IconDocument"},Cn={class:"icon",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},wn=te("path",{fill:"currentColor",d:"M832 384H576V128H192v768h640V384zm-26.496-64L640 154.496V320h165.504zM160 64h480l256 256v608a32 32 0 01-32 32H160a32 32 0 01-32-32V96a32 32 0 0132-32zm160 448h384v64H320v-64zm0-192h160v64H320v-64zm0 384h384v64H320v-64z"},null,-1),On=[wn];function Sn(n,t,e,r,i,o){return ie(),oe("svg",Cn,On)}mt.render=Sn;var vt={name:"IconDelete"},Fn={class:"icon",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},Vn=te("path",{fill:"currentColor",d:"M160 256H96a32 32 0 010-64h256V95.936a32 32 0 0132-32h256a32 32 0 0132 32V192h256a32 32 0 110 64h-64v672a32 32 0 01-32 32H192a32 32 0 01-32-32V256zm448-64v-64H416v64h192zM224 896h576V256H224v640zm192-128a32 32 0 01-32-32V416a32 32 0 0164 0v320a32 32 0 01-32 32zm192 0a32 32 0 01-32-32V416a32 32 0 0164 0v320a32 32 0 01-32 32z"},null,-1),Rn=[Vn];function En(n,t,e,r,i,o){return ie(),oe("svg",Fn,Rn)}vt.render=En;var gt={name:"IconView"},An={class:"icon",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},Pn=te("path",{fill:"currentColor",d:"M512 160c320 0 512 352 512 352S832 864 512 864 0 512 0 512s192-352 512-352zm0 64c-225.28 0-384.128 208.064-436.8 288 52.608 79.872 211.456 288 436.8 288 225.28 0 384.128-208.064 436.8-288-52.608-79.872-211.456-288-436.8-288zm0 64a224 224 0 110 448 224 224 0 010-448zm0 64a160.192 160.192 0 00-160 160c0 88.192 71.744 160 160 160s160-71.808 160-160-71.744-160-160-160z"},null,-1),In=[Pn];function jn(n,t,e,r,i,o){return ie(),oe("svg",An,In)}gt.render=jn;var yt={name:"IconFolderOpened"},kn={class:"icon",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},xn=te("path",{fill:"currentColor",d:"M878.08 448H241.92l-96 384h636.16l96-384zM832 384v-64H485.76L357.504 192H128v448l57.92-231.744A32 32 0 01216.96 384H832zm-24.96 512H96a32 32 0 01-32-32V160a32 32 0 0132-32h287.872l128.384 128H864a32 32 0 0132 32v96h23.04a32 32 0 0131.04 39.744l-112 448A32 32 0 01807.04 896z"},null,-1),Bn=[xn];function Dn(n,t,e,r,i,o){return ie(),oe("svg",kn,Bn)}yt.render=Dn;function Je(n){return typeof n=="function"||Object.prototype.toString.call(n)==="[object Object]"&&!dt(n)}var Tn="fcFrame",Mn=Y({name:Tn,props:{type:{type:String,default:"input"},field:String,helper:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},src:{type:String,required:!0},icon:{type:String,default:"IconFolderOpened"},width:{type:String,default:"500px"},height:{type:String,default:"370px"},maxLength:{type:Number,default:0},okBtnText:{type:String,default:"确定"},closeBtnText:{type:String,default:"关闭"},modalTitle:String,handleIcon:{type:[String,Boolean],default:void 0},title:String,allowRemove:{type:Boolean,default:!0},onOpen:{type:Function,default:function(){}},onOk:{type:Function,default:function(){}},onCancel:{type:Function,default:function(){}},onLoad:{type:Function,default:function(){}},onBeforeRemove:{type:Function,default:function(){}},onRemove:{type:Function,default:function(){}},onHandle:Function,modal:{type:Object,default:function(){return{}}},srcKey:[String,Number],modelValue:[Array,String,Number,Object],previewMask:void 0,footer:{type:Boolean,default:!0},reload:{type:Boolean,default:!0},closeBtn:{type:Boolean,default:!0},okBtn:{type:Boolean,default:!0},formCreateInject:Object},emits:["update:modelValue","change"],components:{IconFolderOpened:yt,IconView:gt},data:function(){return{fileList:L(this.modelValue),previewVisible:!1,frameVisible:!1,previewImage:"",bus:new pt}},watch:{modelValue:function(t){this.fileList=L(t)}},methods:{close:function(){this.closeModel(!0)},closeModel:function(t){this.bus.$emit(t?"$close":"$ok"),this.reload&&(this.bus.$off("$ok"),this.bus.$off("$close")),this.frameVisible=!1},handleCancel:function(){this.previewVisible=!1},showModel:function(){this.disabled||this.onOpen()===!1||(this.frameVisible=!0)},input:function(){var t=this.fileList,e=this.maxLength===1?t[0]||"":t;this.$emit("update:modelValue",e),this.$emit("change",e)},makeInput:function(){var t=this;return y(V("ElInput"),H({type:"text",modelValue:this.fileList.map(function(e){return t.getSrc(e)}).toString(),readonly:!0},{key:1}),{append:function(){return y(V("ElButton"),{icon:V(t.icon),onClick:function(){return t.showModel()}},null)},suffix:function(){return t.fileList.length&&!t.disabled?y(V("ElIcon"),{class:"el-input__icon _fc-upload-icon",onClick:function(){t.fileList=[],t.input()}},{default:function(){return[y(ht,null,null)]}}):null}})},makeGroup:function(t){return(!this.maxLength||this.fileList.length<this.maxLength)&&t.push(this.makeBtn()),y("div",{key:2},[t])},makeItem:function(t,e){return y("div",{class:"_fc-files",key:"3"+t},[e])},valid:function(t){var e=this.formCreateInject.field||this.field;if(e&&t!==e)throw new Error("[frame]无效的字段值")},makeIcons:function(t,e){if(this.handleIcon!==!1||this.allowRemove===!0){var r=[];return(this.type!=="file"&&this.handleIcon!==!1||this.type==="file"&&this.handleIcon)&&r.push(this.makeHandleIcon(t,e)),this.allowRemove&&r.push(this.makeRemoveIcon(t,e)),y("div",{class:"_fc-upload-cover",key:4},[r])}},makeHandleIcon:function(t,e){var r=this,i=V(this.handleIcon===!0||this.handleIcon===void 0?"icon-view":this.handleIcon);return y(V("ElIcon"),{onClick:function(){return r.handleClick(t)},key:"5"+e},{default:function(){return[y(i,null,null)]}})},makeRemoveIcon:function(t,e){var r=this;return y(V("ElIcon"),{onClick:function(){return r.handleRemove(t)},key:"6"+e},{default:function(){return[y(vt,null,null)]}})},makeFiles:function(){var t=this;return this.makeGroup(this.fileList.map(function(e,r){return t.makeItem(r,[y(V("ElIcon"),{onClick:function(){return t.handleClick(e)}},{default:function(){return[y(mt,null,null)]}}),t.makeIcons(e,r)])}))},makeImages:function(){var t=this;return this.makeGroup(this.fileList.map(function(e,r){return t.makeItem(r,[y("img",{src:t.getSrc(e)},null),t.makeIcons(e,r)])}))},makeBtn:function(){var t=this,e=V(this.icon);return y("div",{class:"_fc-upload-btn",onClick:function(){return t.showModel()},key:7},[y(V("ElIcon"),null,{default:function(){return[y(e,null,null)]}})])},handleClick:function(t){if(this.onHandle)return this.onHandle(t);this.previewImage=this.getSrc(t),this.previewVisible=!0},handleRemove:function(t){this.disabled||this.onBeforeRemove(t)!==!1&&(this.fileList.splice(this.fileList.indexOf(t),1),this.input(),this.onRemove(t))},getSrc:function(t){return this.srcKey?t[this.srcKey]:t},frameLoad:function(t){var e=this;this.onLoad(t);try{this.helper===!0&&(t.form_create_helper={api:this.formCreateInject.api,close:function(i){e.valid(i),e.closeModel()},set:function(i,o){e.valid(i),!e.disabled&&e.$emit("update:modelValue",o)},get:function(i){return e.valid(i),e.modelValue},onOk:function(i){return e.bus.$on("$ok",i)},onClose:function(i){return e.bus.$on("$close",i)}})}catch(r){console.error(r)}},makeFooter:function(){var t=this,e=this.$props,r=e.okBtnText,i=e.closeBtnText,o=e.closeBtn,a=e.okBtn,u=e.footer;if(u)return y("div",null,[o?y(V("ElButton"),{onClick:function(){return t.onCancel()!==!1&&(t.frameVisible=!1)}},Je(i)?i:{default:function(){return[i]}}):null,a?y(V("ElButton"),{type:"primary",onClick:function(){return t.onOk()!==!1&&t.closeModel()}},Je(r)?r:{default:function(){return[r]}}):null])}},render:function(){var t=this,e=this.type,r;e==="input"?r=this.makeInput():e==="image"?r=this.makeImages():r=this.makeFiles();var i=this.$props,o=i.width,a=o===void 0?"30%":o,u=i.height,s=i.src,l=i.title,f=i.modalTitle;return J(function(){t.$refs.frame&&t.frameLoad(t.$refs.frame.contentWindow||{})}),y("div",{class:{"_fc-frame":!0,"_fc-disabled":this.disabled}},[r,y(V("ElDialog"),{appendToBody:!0,modal:this.previewMask,title:f,modelValue:this.previewVisible,onClose:this.handleCancel},{default:function(){return[y("img",{style:"width: 100%",src:t.previewImage},null)]}}),y(V("ElDialog"),H({appendToBody:!0},_({width:a,title:l},this.modal),{modelValue:this.frameVisible,onClose:function(){return t.closeModel(!0)}}),{default:function(){return[t.frameVisible||!t.reload?y("iframe",{ref:"frame",src:s,frameBorder:"0",style:{height:u,border:"0 none",width:"100%"}},null):null]},footer:function(){return t.makeFooter()}})])},beforeMount:function(){var t=this.formCreateInject,e=t.name,r=t.field,i=t.api;e&&i.on("fc:closeModal:"+e,this.close),r&&i.on("fc:closeModal:"+r,this.close)},beforeUnmount:function(){var t=this.formCreateInject,e=t.name,r=t.field,i=t.api;e&&i.off("fc:closeModal:"+e,this.close),r&&i.off("fc:closeModal:"+r,this.close)}}),Nn="fcRadio",Ln=Y({name:Nn,inheritAttrs:!1,props:{formCreateInject:Object,modelValue:{type:[String,Number,Boolean],default:""},type:String},emits:["update:modelValue","fc.el"],setup:function(t,e){var r=z(t.formCreateInject,"options",[]),i=z(t,"modelValue"),o=function(){return Array.isArray(r.value)?r.value:[]};return{options:o,value:i,onInput:function(u){e.emit("update:modelValue",u)}}},render:function(){var t,e,r=this,i=this.type==="button"?"ElRadioButton":"ElRadio",o=V(i);return y(V("ElRadioGroup"),H(this.$attrs,{modelValue:this.value,"onUpdate:modelValue":this.onInput,ref:"el"}),_({default:function(){return[r.options().map(function(u,s){var l=_({},u),f=l.value;return delete l.value,y(o,H(l,{label:f,key:i+s+"-"+u.value}),{default:function(){return[l.label||l.value||""]}})}),(t=(e=r.$slots).default)===null||t===void 0?void 0:t.call(e)]}},be(this.$slots,["default"])))},mounted:function(){this.$emit("fc.el",this.$refs.el)}}),p={type:function(t,e){return Object.prototype.toString.call(t)==="[object "+e+"]"},Undef:function(t){return t==null},Element:function(t){return K(t)==="object"&&t!==null&&t.nodeType===1&&!p.Object(t)},trueArray:function(t){return Array.isArray(t)&&t.length>0},Function:function(t){var e=this.getType(t);return e==="Function"||e==="AsyncFunction"},getType:function(t){var e=Object.prototype.toString.call(t);return/^\[object (.*)\]$/.exec(e)[1]},empty:function(t){return t==null||Array.isArray(t)&&Array.isArray(t)&&!t.length?!0:typeof t=="string"&&!t}};["Date","Object","String","Boolean","Array","Number"].forEach(function(n){p[n]=function(t){return p.type(t,n)}});function I(n,t){return{}.hasOwnProperty.call(n,t)}var Un="fcSelect",Hn=Y({name:Un,inheritAttrs:!1,props:{formCreateInject:Object,modelValue:{type:[Array,String,Number,Boolean,Object],default:void 0},type:String},emits:["update:modelValue","fc.el"],setup:function(t){var e=z(t.formCreateInject,"options",[]),r=z(t,"modelValue"),i=function(){return Array.isArray(e.value)?e.value:[]};return{options:i,value:r}},render:function(){var t=this,e,r,i=function(s,l){return y(V("ElOption"),H(s,{key:""+l+"-"+s.value}),null)},o=function(s,l){return y(V("ElOptionGroup"),{label:s.label,key:""+l+"-"+s.label},{default:function(){return[p.trueArray(s.options)&&s.options.map(function(c,d){return i(c,d)})]}})},a=this.options();return y(V("ElSelect"),H(this.$attrs,{modelValue:this.value,"onUpdate:modelValue":function(s){return t.$emit("update:modelValue",s)},ref:"el"}),_({default:function(){return[a.map(function(s,l){return I(s||"","options")?o(s,l):i(s,l)}),(e=(r=t.$slots).default)===null||e===void 0?void 0:e.call(r)]}},be(this.$slots,["default"])))},mounted:function(){this.$emit("fc.el",this.$refs.el)}}),zn="fcTree",Yn=Y({name:zn,inheritAttrs:!1,formCreateParser:{mergeProp:function(t){var e=t.prop.props;e.nodeKey||(e.nodeKey="id"),e.props||(e.props={label:"title"})}},props:{type:String,modelValue:{type:[Array,String,Number],default:function(){return[]}}},emits:["update:modelValue","fc.el"],watch:{modelValue:function(){this.setValue()}},methods:{updateValue:function(){if(this.$refs.tree){var t;this.type==="selected"?t=this.$refs.tree.getCurrentKey():t=this.$refs.tree.getCheckedKeys(),this.$emit("update:modelValue",t)}},setValue:function(){if(this.$refs.tree){var t=this.type;t==="selected"?this.$refs.tree.setCurrentKey(this.modelValue):this.$refs.tree.setCheckedKeys(L(this.modelValue))}}},render:function(){return y(V("ElTree"),H(this.$attrs,{ref:"tree",onCheck:this.updateValue,"onNode-click":this.updateValue}),this.$slots)},mounted:function(){this.setValue(),this.$emit("fc.el",this.$refs.tree)}}),qn="._fc-exceed .el-upload{display:none}.el-upload-list.is-disabled .el-upload{cursor:not-allowed!important}";$e(qn);var _t={name:"IconUpload"},Wn={class:"icon",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},Jn=te("path",{fill:"currentColor",d:"M160 832h704a32 32 0 110 64H160a32 32 0 110-64zm384-578.304V704h-64V247.296L237.248 490.048 192 444.8 508.8 128l316.8 316.8-45.312 45.248L544 253.696z"},null,-1),Kn=[Jn];function Gn(n,t,e,r,i,o){return ie(),oe("svg",Wn,Kn)}_t.render=Gn;function Ke(n,t){return{url:n,name:Xn(n),uid:t}}function Xn(n){return(""+n).split("/").pop()}var Qn="fcUpload",Zn=Y({name:Qn,inheritAttrs:!1,formCreateParser:{toFormValue:function(t){return L(t)},toValue:function(t,e){return e.prop.props.limit===1?t[0]||"":t}},props:{previewMask:void 0,onPreview:Function,modalTitle:String,modelValue:[Array,String]},emits:["update:modelValue","change","remove","fc.el"],data:function(){return{previewVisible:!1,previewImage:"",fileList:[]}},created:function(){this.fileList=L(this.modelValue).map(Ke)},watch:{modelValue:function(t){this.fileList=L(t).map(Ke)}},methods:{handlePreview:function(t){this.onPreview?this.onPreview.apply(this,arguments):(this.previewImage=t.url,this.previewVisible=!0)},update:function(t){var e=t.map(function(r){return r.url}).filter(function(r){return r!==void 0});this.$emit("update:modelValue",e)},handleCancel:function(){this.previewVisible=!1},handleChange:function(t,e){this.$emit.apply(this,["change"].concat(Array.prototype.slice.call(arguments))),t.status==="success"&&this.update(e)},handleRemove:function(t,e){this.$emit.apply(this,["remove"].concat(Array.prototype.slice.call(arguments))),this.update(e)}},render:function(){var t,e,r=this,i=L(this.modelValue).length;return y(Gt,null,[y(V("ElUpload"),H({key:i,"list-type":"picture-card"},this.$attrs,{class:{"_fc-exceed":this.$attrs.limit?this.$attrs.limit<=i:!1},onPreview:this.handlePreview,onChange:this.handleChange,onRemove:this.handleRemove,fileList:this.fileList,ref:"upload"}),_({default:function(){return[((t=(e=r.$slots).default)===null||t===void 0?void 0:t.call(e))||y(V("ElIcon"),null,{default:function(){return[y(_t,null,null)]}})]}},be(this.$slots,["default"]))),y(V("ElDialog"),{appendToBody:!0,modal:this.previewMask,title:this.modalTitle,modelValue:this.previewVisible,onClose:this.handleCancel},{default:function(){return[y("img",{style:"width: 100%",src:r.previewImage},null)]}})])},mounted:function(){this.$emit("fc.el",this.$refs.upload)}});function N(n,t,e){n[t]=e}function se(n,t){delete n[t]}function ce(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0,r=!1;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var o=t[i];if((r=Array.isArray(o))||p.Object(o)){var a=n[i]===void 0;if(r)r=!1,a&&N(n,i,[]);else if(o._clone&&e!==void 0)if(e)o=o.getRule(),a&&N(n,i,{});else{N(n,i,o._clone());continue}else a&&N(n,i,{});n[i]=ce(n[i],o,e)}else N(n,i,o),p.Undef(o)||(p.Undef(o.__json)||(n[i].__json=o.__json),p.Undef(o.__origin)||(n[i].__origin=o.__origin))}return e!==void 0&&Array.isArray(n)?n.filter(function(u){return!u||!u.__ctrl}):n}function Q(n){return ce({},{value:n}).value}var er=Object.assign||function(n){for(var t,e=1;e<arguments.length;e++)for(var r in t=arguments[e],t)Object.prototype.hasOwnProperty.call(t,r)&&N(n,r,t[r]);return n};function b(){return er.apply(this,arguments)}var tr='._fc-group{display:flex;flex-direction:column;justify-content:center;min-height:38px;width:100%}._fc-group-disabled ._fc-group-add,._fc-group-disabled ._fc-group-btn{cursor:not-allowed}._fc-group-handle{background-color:#fff;border:1px dashed #d9d9d9;border-radius:15px;bottom:-15px;display:flex;flex-direction:row;padding:3px 8px;position:absolute;right:30px}._fc-group-btn{cursor:pointer}._fc-group-idx{align-items:center;background:#eee;border-radius:15px;bottom:-15px;display:flex;font-weight:700;height:30px;justify-content:center;left:10px;position:absolute;width:30px}._fc-group-handle ._fc-group-btn+._fc-group-btn{margin-left:7px}._fc-group-container{border:1px dashed #d9d9d9;border-radius:5px;display:flex;flex-direction:column;margin:5px 5px 25px;padding:20px 20px 25px;position:relative}._fc-group-arrow{height:20px;position:relative;width:20px}._fc-group-arrow:before{border-left:2px solid #999;border-top:2px solid #999;content:"";height:9px;left:5px;position:absolute;top:8px;transform:rotate(45deg);width:9px}._fc-group-arrow._fc-group-down{transform:rotate(180deg)}._fc-group-plus-minus{cursor:pointer;height:20px;position:relative;width:20px}._fc-group-plus-minus:after,._fc-group-plus-minus:before{background-color:#409eff;content:"";height:2px;left:50%;position:absolute;top:50%;transform:translate(-50%,-50%);width:60%}._fc-group-plus-minus:before{transform:translate(-50%,-50%) rotate(90deg)}._fc-group-plus-minus._fc-group-minus:before{display:none}._fc-group-plus-minus._fc-group-minus:after{background-color:#f56c6c}._fc-group-add{border:1px solid rgba(64,158,255,.5);border-radius:15px;cursor:pointer;height:25px;width:25px}._fc-group-add._fc-group-plus-minus:after,._fc-group-add._fc-group-plus-minus:before{width:50%}';$e(tr);var nr="fcGroup",rr=Y({name:nr,props:{field:String,rule:Array,expand:Number,options:Object,button:{type:Boolean,default:!0},max:{type:Number,default:0},min:{type:Number,default:0},modelValue:{type:Array,default:function(){return[]}},defaultValue:Object,sortBtn:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},syncDisabled:{type:Boolean,default:!0},onBeforeRemove:{type:Function,default:function(){}},onBeforeAdd:{type:Function,default:function(){}},formCreateInject:Object,parse:Function},data:function(){return{len:0,cacheRule:{},cacheValue:{},sort:[],form:ue(this.formCreateInject.form.$form())}},emits:["update:modelValue","change","itemMounted","remove","add"],watch:{rule:{handler:function(t,e){var r=this;Object.keys(this.cacheRule).forEach(function(i){var o=r.cacheRule[i];if(o.$f){var a=o.$f.formData();if(t===e)o.$f.deferSyncValue(function(){ce(o.rule,t),o.$f.setValue(a)},!0);else{var u=o.$f.formData();o.$f.once("reloading",function(){o.$f.setValue(u)}),o.rule=Q(t)}}})},deep:!0},disabled:function(t){if(this.syncDisabled){var e=this.cacheRule;Object.keys(e).forEach(function(r){e[r].$f.disabled(t)})}},expand:function(t){var e=t-this.modelValue.length;e>0&&this.expandRule(e)},modelValue:{handler:function(t){var e=this;t=t||[];var r=Object.keys(this.sort),i=r.length,o=i-t.length;if(o<0){for(var a=o;a<0;a++)this.addRule(t.length+a,!0);for(var u=0;u<i;u++)this.setValue(r[u],t[u])}else{if(o>0)for(var s=0;s<o;s++)this.removeRule(r[i-s-1]);t.forEach(function(l,f){e.setValue(r[f],t[f])})}},deep:!0}},methods:{_value:function(t){return t&&I(t,this.field)?t[this.field]:t},cache:function(t,e){this.cacheValue[t]=JSON.stringify(e)},input:function(t){this.$emit("update:modelValue",t),this.$emit("change",t)},formData:function(t,e){var r=this,i=this.cacheRule,o=this.sort;if(o.filter(function(u){return i[u].$f}).length===o.length){var a=o.map(function(u){var s=t===u?e:_({},r.cacheRule[u].$f.form),l=r.field?s[r.field]||null:s;return r.cache(u,l),l});this.input(a)}},setValue:function(t,e){var r=this.field;r&&(e=j({},r,this._value(e))),this.cacheValue[t]!==JSON.stringify(r?e[r]:e)&&this.cache(t,e)},addRule:function(t,e){var r=this,i=this.formCreateInject.form.copyRules(this.rule||[]),o=this.options?_({},this.options):{submitBtn:!1,resetBtn:!1};if(this.defaultValue){o.formData||(o.formData={});var a=Q(this.defaultValue);b(o.formData,this.field?j({},this.field,a):a)}this.parse&&this.parse({rule:i,options:o,index:this.sort.length}),this.cacheRule[++this.len]={rule:i,options:o},e&&J(function(){return r.$emit("add",i,Object.keys(r.cacheRule).length-1)})},add$f:function(t,e,r){var i=this;this.cacheRule[e].$f=r,J(function(){i.syncDisabled&&r.disabled(i.disabled),i.$emit("itemMounted",r,Object.keys(i.cacheRule).indexOf(e))})},removeRule:function(t,e){var r=this,i=Object.keys(this.cacheRule).indexOf(t);delete this.cacheRule[t],delete this.cacheValue[t],e&&J(function(){return r.$emit("remove",i)})},add:function(t){if(!(this.disabled||this.onBeforeAdd(this.modelValue)===!1)){var e=S(this.modelValue);e.push(this.defaultValue?Q(this.defaultValue):this.field?null:{}),this.input(e)}},del:function(t,e){if(!(this.disabled||this.onBeforeRemove(this.modelValue,t)===!1)){this.removeRule(e,!0);var r=S(this.modelValue);r.splice(t,1),this.input(r)}},addIcon:function(t){return y("div",{class:"_fc-group-btn _fc-group-plus-minus",onClick:this.add},null)},delIcon:function(t,e){var r=this;return y("div",{class:"_fc-group-btn _fc-group-plus-minus _fc-group-minus",onClick:function(){return r.del(t,e)}},null)},sortUpIcon:function(t){var e=this;return y("div",{class:"_fc-group-btn _fc-group-arrow _fc-group-up",onClick:function(){return e.changeSort(t,-1)}},null)},sortDownIcon:function(t){var e=this;return y("div",{class:"_fc-group-btn _fc-group-arrow _fc-group-down",onClick:function(){return e.changeSort(t,1)}},null)},changeSort:function(t,e){var r=this.sort[t];this.sort[t]=this.sort[t+e],this.sort[t+e]=r,this.formData(0)},makeIcon:function(t,e,r){var i=this;if(this.$slots.button)return this.$slots.button({total:t,index:e,vm:this,key:r,del:function(){return i.del(e,r)},add:this.add});var o=[];return(!this.max||t<this.max)&&t===e+1&&o.push(this.addIcon(r)),t>this.min&&o.push(this.delIcon(e,r)),this.sortBtn&&e&&o.push(this.sortUpIcon(e)),this.sortBtn&&e!==t-1&&o.push(this.sortDownIcon(e)),o},emitEvent:function(t,e,r,i){this.$emit.apply(this,[t].concat(S(e),[this.cacheRule[i].$f,r]))},expandRule:function(t){for(var e=0;e<t;e++)this.addRule(e)}},created:function(){var t=this;U(function(){return _({},t.cacheRule)},function(i){t.sort=Object.keys(i)},{immediate:!0});for(var e=(this.expand||0)-this.modelValue.length,r=0;r<this.modelValue.length;r++)this.addRule(r);e>0&&this.expandRule(e)},render:function(){var t=this,e=this.sort,r=this.button,i=this.form,o=this.disabled,a=e.length===0?this.$slots.default?this.$slots.default({vm:this,add:this.add}):y("div",{key:"a_def",class:"_fc-group-plus-minus _fc-group-add",onClick:this.add},null):e.map(function(u,s){var l=t.cacheRule[u],f=l.rule,c=l.options,d=r&&!o?t.makeIcon(e.length,s,u):[];return y("div",{class:"_fc-group-container",key:u},[y(i,H({key:u},{"onUpdate:modelValue":function(g){return t.formData(u,g)},"onEmit-event":function(g){for(var $=arguments.length,w=new Array($>1?$-1:0),F=1;F<$;F++)w[F-1]=arguments[F];return t.emitEvent(g,w,s,u)},"onUpdate:api":function(g){return t.add$f(s,u,g)},inFor:!0,modelValue:t.field?j({},t.field,t._value(t.modelValue[s])):t.modelValue[s],rule:f,option:c,extendOption:!0}),null),y("div",{class:"_fc-group-idx"},[s+1]),d.length?y("div",{class:"_fc-group-handle"},[d]):null])});return y("div",{key:"con",class:"_fc-group "+(o?"_fc-group-disabled":"")},[a])}}),ir="fcSubForm",or=Y({name:ir,props:{rule:Array,options:{type:Object,default:function(){return ne({submitBtn:!1,resetBtn:!1})}},modelValue:{type:Object,default:function(){return{}}},disabled:{type:Boolean,default:!1},syncDisabled:{type:Boolean,default:!0},formCreateInject:Object},data:function(){return{cacheValue:{},subApi:{},form:ue(this.formCreateInject.form.$form())}},emits:["fc:subform","update:modelValue","change","itemMounted"],watch:{disabled:function(t){this.syncDisabled&&this.subApi.disabled(t)},modelValue:function(t){this.setValue(t)}},methods:{formData:function(t){this.cacheValue=JSON.stringify(t),this.$emit("update:modelValue",t),this.$emit("change",t)},setValue:function(t){var e=JSON.stringify(t);this.cacheValue!==e&&(this.cacheValue=e,this.subApi.coverValue(t||{}))},add$f:function(t){var e=this;this.subApi=t,J(function(){e.syncDisabled&&t.disabled(e.disabled),e.$emit("itemMounted",t)})}},render:function(){var t=this.form;return y(t,{"onUpdate:modelValue":this.formData,modelValue:this.modelValue,"onEmit-event":this.$emit,"onUpdate:api":this.add$f,rule:this.rule,option:this.options,extendOption:!0},null)}}),bt={name:"IconWarning"},ar={class:"icon",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},ur=te("path",{fill:"currentColor",d:"M512 64a448 448 0 110 896 448 448 0 010-896zm0 832a384 384 0 000-768 384 384 0 000 768zm48-176a48 48 0 11-96 0 48 48 0 0196 0zm-48-464a32 32 0 0132 32v288a32 32 0 01-64 0V288a32 32 0 0132-32z"},null,-1),sr=[ur];function lr(n,t,e,r,i,o){return ie(),oe("svg",ar,sr)}bt.render=lr;var fr=[mn,Mn,Ln,Hn,Yn,Zn,rr,or,bt],cr="FormCreate",Ge=function n(t,e){if(!(!t||t===e)){if(t.props.formCreateInject)return t.props.formCreateInject;if(t.parent)return n(t.parent,e)}};function dr(n,t,e){return Y({name:cr,components:t,directives:e,props:{rule:{type:Array,required:!0,default:function(){return[]}},option:{type:Object,default:function(){return{}}},extendOption:Boolean,modelValue:Object,api:Object,name:String,subForm:{type:Boolean,default:!0},inFor:Boolean},emits:["update:api","update:modelValue","mounted","submit","change","emit-event","control","remove-rule","remove-field","sync","reload","repeat-field","update","validate-field-fail","validate-fail"],render:function(){return this.fc.render()},setup:function(i){var o=Pe();Xt("parentFC",o);var a=Qt("parentFC",null),u=qe(i),s=u.rule,l=u.modelValue,f=u.subForm,c=u.inFor,d=ne({ctxInject:{},destroyed:!1,isShow:!0,unique:1,renderRule:S(s.value||[]),updateValue:JSON.stringify(l||{})}),v=new n(o),g=v.api(),$=c.value,w=function(){if(a){var R=Ge(o,a);if(R){var P;$?(P=L(R.getSubForm()),P.push(g)):P=g,R.subForm(P)}}},F=function(){var R=Ge(o,a);if(R)if($){var P=L(R.getSubForm()),D=P.indexOf(g);D>-1&&P.splice(D,1)}else R.subForm()};return Zt(function(){v.mounted()}),en(function(){F(),d.destroyed=!0,v.unmount()}),tn(function(){v.updated()}),U(f,function(C){C?w():F()},{immediate:!0}),U(function(){return S(s.value)},function(C){v.$handle.isBreakWatch()||C.length===d.renderRule.length&&C.every(function(R){return d.renderRule.indexOf(R)>-1})||(v.$handle.reloadRule(s.value),o.setupState.renderRule())}),U(function(){return i.option},function(C){v.initOptions(C),g.refresh()},{deep:!0}),U(l,function(C){JSON.stringify(C||{})!==d.updateValue&&(g.config.forceCoverValue?g.coverValue(C||{}):g.setValue(C||{}))},{deep:!0}),_(_({fc:ue(v),parent:a&&ue(a),fapi:ue(g)},qe(d)),{},{refresh:function(){++d.unique},renderRule:function(){d.renderRule=S(s.value||[])},updateValue:function(R){d.destroyed||(d.updateValue=JSON.stringify(R),o.emit("update:modelValue",R))}})},created:function(){var i=Pe();i.setupState.fc.init(),i.emit("update:api",i.setupState.fapi)}})}var $t=["props"],Ct=["class","style","directives"],wt=["on"],X=function n(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=[].concat($t,S(r.normal||[])),o=[].concat(Ct,S(r.array||[])),a=[].concat(wt,S(r.functional||[])),u=r.props||[];return t.reduce(function(s,l){for(var f in l)if(s[f])if(u.indexOf(f)>-1)s[f]=n([l[f]],s[f]);else if(i.indexOf(f)>-1)s[f]=_(_({},s[f]),l[f]);else if(o.indexOf(f)>-1){var c=s[f]instanceof Array?s[f]:[s[f]],d=l[f]instanceof Array?l[f]:[l[f]];s[f]=[].concat(S(c),S(d))}else if(a.indexOf(f)>-1)for(var v in l[f])if(s[f][v]){var g=s[f][v]instanceof Array?s[f][v]:[s[f][v]],$=l[f][v]instanceof Array?l[f][v]:[l[f][v]];s[f][v]=[].concat(S(g),S($))}else s[f][v]=l[f][v];else if(f==="hook")for(var w in l[f])s[f][w]?s[f][w]=pr(s[f][w],l[f][w]):s[f][w]=l[f][w];else s[f]=l[f];else i.indexOf(f)>-1||a.indexOf(f)>-1||u.indexOf(f)>-1?s[f]=_({},l[f]):o.indexOf(f)>-1?s[f]=l[f]instanceof Array?S(l[f]):K(l[f])==="object"?_({},l[f]):l[f]:s[f]=l[f];return s},e)},pr=function(t,e){return function(){t&&t.apply(this,arguments),e&&e.apply(this,arguments)}},ke=["type","slot","emitPrefix","value","name","native","hidden","display","inject","options","emit","link","prefix","suffix","update","sync","optionsTo","key","slotUpdate","computed","preview","component","cache"],he=["validate","children","control"],me=["effect"];function Ot(){return[].concat(ke,S($t),S(Ct),S(wt),he,me)}function St(n,t,e){return"[form-create ".concat(n,"]: ").concat(t)+(e?`

rule: `+JSON.stringify(e.getRule?e.getRule():e):"")}function Me(n,t){console.error(St("err",n,t))}function hr(n){Me(n.toString()),console.error(n)}function ve(n){var t=n.replace(/([A-Z])/g,"-$1").toLocaleLowerCase();return t.indexOf("-")===0&&(t=t.substr(1)),t}function mr(n){return n.replace(n[0],n[0].toLocaleUpperCase())}var xe="[[FORM-CREATE-PREFIX-",Be="-FORM-CREATE-SUFFIX]]",Xe="$FN:",Qe="$FNX:",le="function";function Ft(n,t){return JSON.stringify(ce([],n,!0),function(e,r){if(!(r&&r._isVue===!0)){if(K(r)!==le)return r;if(r.__json)return r.__json;if(r.__origin&&(r=r.__origin),!r.__emit)return xe+r+Be}},t)}function Ze(n){return new Function("return "+n)()}function fe(n,t){if(n&&p.String(n)&&n.length>4){var e=n.trim(),r=!1;try{if(e.indexOf(Be)>0&&e.indexOf(xe)===0)e=e.replace(Be,"").replace(xe,""),r=!0;else if(e.indexOf(Xe)===0)e=e.replace(Xe,""),r=!0;else{if(e.indexOf(Qe)===0)return e=Ze("function($inject){"+e.replace(Qe,"")+"}"),e.__json=n,e.__inject=!0,e;!t&&e.indexOf(le)===0&&e!==le&&(r=!0)}if(!r)return n;var i=Ze(e.indexOf(le)===-1&&e.indexOf("(")!==0?le+" "+e:e);return i.__json=n,i}catch(o){Me("解析失败:".concat(e,`

err: `).concat(o));return}}return n}function vr(n,t){return JSON.parse(n,function(e,r){return p.Undef(r)||!r.indexOf?r:fe(r,t)})}function Vt(n,t){return{value:n,enumerable:!1,configurable:!1,writable:!!t}}function Ne(n,t){return Rt([n],t||!1)[0]}function Rt(n,t){return ce([],S(n),t||!1)}function Z(n,t){return X(Array.isArray(t)?t:[t],n,{array:he,normal:me}),n}function et(n){var t=p.Function(n.getRule)?n.getRule():n;return t.type||(t.type="input"),t}function gr(n,t){return n?(Object.keys(t||{}).forEach(function(e){t[e]&&(n[e]=Z(n[e]||{},t[e]))}),n):t}function Et(n,t){Object.defineProperties(n,Object.keys(t).reduce(function(e,r){return e[r]={get:function(){return t[r]()}},e},{}))}function ge(n){return n.__fc__||(n.__origin__?n.__origin__.__fc__:null)}function k(n,t){try{t=n()}catch(e){hr(e)}return t}function we(){var n={},t=function(r){return r||"default"};return{setSlot:function(r,i){r=t(r),!(!i||Array.isArray(i)&&i.length)&&(n[r]||(n[r]=[]),n[r].push(i))},getSlot:function(r,i){r=t(r);var o=[];return(n[r]||[]).forEach(function(a){if(Array.isArray(a))o.push.apply(o,S(a));else if(p.Function(a)){var u=a.apply(void 0,S(i||[]));Array.isArray(u)?o.push.apply(o,S(u)):o.push(u)}else p.Undef(a)||o.push(a)}),o},getSlots:function(){var r=this,i={};return Object.keys(n).forEach(function(o){i[o]=function(){for(var a=arguments.length,u=new Array(a),s=0;s<a;s++)u[s]=arguments[s];return r.getSlot(o,u)}}),i},slotLen:function(r){return r=t(r),n[r]?n[r].length:0},mergeBag:function(r){var i=this;if(!r)return this;var o=p.Function(r.getSlots)?r.getSlots():r;return Array.isArray(r)||dt(r)?this.setSlot(void 0,function(){return r}):Object.keys(o).forEach(function(a){i.setSlot(a,o[a])}),this}}}function tt(n){var t=_({},n.props||{});return Object.keys(n.on||{}).forEach(function(e){var r="on".concat(mr(e));Array.isArray(t[r])?t[r]=[].concat(S(t[r]),[n.on[e]]):t[r]?t[r]=[t[r],n.on[e]]:t[r]=n.on[e]}),t.key=n.key,t.ref=n.ref,t.class=n.class,t.style=n.style,t.slot&&delete t.slot,t}function At(){return{props:{},on:{},options:[],children:[],hidden:!1,display:!0,value:void 0}}function B(n,t){return function(e,r,i){var o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},a=new Le(n,e,r,i,o);return t&&(p.Function(t)?t(a):a.props(t)),a}}function Le(n,t,e,r,i){this._data=b(At(),{type:n,title:t,field:e,value:r,props:i||{}}),this.event=this.on}b(Le.prototype,{getRule:function(){return this._data},setProp:function(t,e){return N(this._data,t,e),this},modelField:function(t){return this._data.modelField=t,this},_clone:function(){var t=new this.constructor;return t._data=Ne(this._data),t}});function Pt(n){n.forEach(function(t){Le.prototype[t]=function(e){return Z(this._data,j({},t,arguments.length<2?e:j({},e,arguments[1]))),this}})}Pt(Ot());var yr=B("");function _r(n,t,e){var r=yr("",t);return r._data.type=n,r._data.title=e,r}function br(){return{create:_r,factory:B}}function Oe(n){return Q(n)}function $r(n){function t(o){return p.Undef(o)?o=n.fields():Array.isArray(o)||(o=[o]),o}function e(o,a,u){t(o).forEach(function(s){n.getCtxs(s).forEach(function(l){N(l.rule,a,u),n.$render.clearCache(l)})})}function r(){var o=n.subForm;return Object.keys(o).reduce(function(a,u){var s=o[u];return s&&(Array.isArray(s)?a.push.apply(a,S(s)):a.push(s)),a},[])}var i={get config(){return n.options},set config(o){n.fc.options.value=o},get options(){return n.options},set options(o){n.fc.options.value=o},get form(){return n.form},get rule(){return n.rules},get parent(){return n.vm.parent&&n.vm.parent.setupState.fapi},get children(){return r()},formData:function(a){return t(a).reduce(function(u,s){var l=n.getFieldCtx(s);return l&&(u[l.field]=Oe(l.rule.value)),u},{})},getValue:function(a){var u=n.getFieldCtx(a);if(u)return Oe(u.rule.value)},coverValue:function(a){var u=_({},a||{});n.deferSyncValue(function(){i.fields().forEach(function(s){var l=n.fieldCtx[s];if(l){var f=I(a,s);l.forEach(function(c){c.rule.value=f?a[s]:void 0}),delete u[s]}}),b(n.appendData,u)})},setValue:function(a){var u=a;arguments.length>=2&&(u=j({},a,arguments[1])),n.deferSyncValue(function(){Object.keys(u).forEach(function(s){var l=n.fieldCtx[s];if(!l)return n.appendData[s]=u[s];l.forEach(function(f){f.rule.value=u[s]})})})},removeField:function(a){var u=n.getCtx(a);return n.deferSyncValue(function(){n.getCtxs(a).forEach(function(s){s.rm()})},!0),u?u.origin:void 0},removeRule:function(a){var u=a&&ge(a);if(u)return u.rm(),u.origin},fields:function(){return n.fields()},append:function(a,u,s){var l=n.sort.length-1,f,c=n.getCtx(u);if(c)if(s){if(f=c.getPending("children",c.rule.children),!Array.isArray(f))return;l=c.rule.children.length-1}else l=c.root.indexOf(c.origin),f=c.root;else f=n.rules;f.splice(l+1,0,a)},prepend:function(a,u,s){var l=0,f,c=n.getCtx(u);if(c)if(s){if(f=c.getPending("children",c.rule.children),!Array.isArray(f))return}else l=c.root.indexOf(c.origin),f=c.root;else f=n.rules;f.splice(l,0,a)},hidden:function(a,u){e(u,"hidden",!!a),n.refresh()},hiddenStatus:function(a){var u=n.getCtx(a);if(u)return!!u.rule.hidden},display:function(a,u){e(u,"display",!!a),n.refresh()},displayStatus:function(a){var u=n.getCtx(a);if(u)return!!u.rule.display},disabled:function(a,u){t(u).forEach(function(s){n.getCtxs(s).forEach(function(l){N(l.rule.props,"disabled",!!a)})}),n.refresh()},all:function(a){return Object.keys(n.ctxs).map(function(u){var s=n.ctxs[u];return a?s.origin:s.rule})},model:function(a){return n.fields().reduce(function(u,s){var l=n.fieldCtx[s][0];return u[s]=a?l.origin:l.rule,u},{})},component:function(a){return Object.keys(n.nameCtx).reduce(function(u,s){var l=n.nameCtx[s].map(function(f){return a?f.origin:f.rule});return u[s]=l.length===1?l[0]:l,u},{})},bind:function(){return i.form},reload:function(a){n.reloadRule(a)},updateOptions:function(a){n.fc.updateOptions(a),i.refresh()},onSubmit:function(a){i.updateOptions({onSubmit:a})},sync:function(a){if(Array.isArray(a)){a.forEach(function(s){return i.sync(s)});return}var u=p.Object(a)?ge(a):n.getCtxs(a);u&&(u=Array.isArray(u)?u:[u],u.forEach(function(s){if(!s.deleted){var l=n.subForm[s.id];l&&(Array.isArray(l)?l.forEach(function(f){f.refresh()}):l&&l.refresh()),n.$render.clearCache(s)}}),n.refresh())},refresh:function(){r().forEach(function(a){a.refresh()}),n.$render.clearCacheAll(),n.refresh()},refreshOptions:function(){n.$manager.updateOptions(n.options),i.refresh()},hideForm:function(a){n.vm.setupState.isShow=!a},changeStatus:function(){return n.changeStatus},clearChangeStatus:function(){n.changeStatus=!1},updateRule:function(a,u){n.getCtxs(a).forEach(function(s){b(s.rule,u)})},updateRules:function(a){Object.keys(a).forEach(function(u){i.updateRule(u,a[u])})},mergeRule:function(a,u){n.getCtxs(a).forEach(function(s){Z(s.rule,u)})},mergeRules:function(a){Object.keys(a).forEach(function(u){i.mergeRule(u,a[u])})},getRule:function(a,u){var s=n.getCtx(a);if(s)return u?s.origin:s.rule},setEffect:function(a,u,s){var l=n.getCtx(a);l&&u&&(u[0]==="$"&&(u=u.substr(1)),I(l.rule,"$"+u)&&N(l.rule,"$"+u,s),I(l.rule,"effect")||(l.rule.effect={}),N(l.rule.effect,u,s))},clearEffectData:function(a,u){var s=n.getCtx(a);s&&(u&&u[0]==="$"&&(u=u.substr(1)),s.clearEffectData(u),i.sync(a))},updateValidate:function(a,u,s){s?i.mergeRule(a,{validate:u}):e(a,"validate",u)},updateValidates:function(a,u){Object.keys(a).forEach(function(s){i.updateValidate(s,a[s],u)})},refreshValidate:function(){i.refresh()},resetFields:function(a){t(a).forEach(function(u){n.getCtxs(u).forEach(function(s){n.$render.clearCache(s),s.rule.value=Oe(s.defaultValue)})})},method:function(a,u){var s=i.el(a);if(!s||!s[u])throw new Error(St("err","".concat(u,"方法不存在")));return function(){return s[u].apply(s,arguments)}},exec:function(a,u){for(var s=arguments.length,l=new Array(s>2?s-2:0),f=2;f<s;f++)l[f-2]=arguments[f];return k(function(){return i.method(a,u).apply(void 0,l)})},toJson:function(a){return Ft(i.rule,a)},trigger:function(a,u){for(var s=i.el(a),l=arguments.length,f=new Array(l>2?l-2:0),c=2;c<l;c++)f[c-2]=arguments[c];s&&s.$emit.apply(s,[u].concat(f))},el:function(a){var u=n.getCtx(a);if(u)return u.el||n.vm.refs[u.ref]},closeModal:function(a){n.bus.$emit("fc:closeModal:"+a)},getSubForm:function(a){var u=n.getCtx(a);return u?n.subForm[u.id]:void 0},nextTick:function(a){n.bus.$once("next-tick",a),n.refresh()},nextRefresh:function(a){n.nextRefresh(),a&&k(a)},deferSyncValue:function(a,u){n.deferSyncValue(a,u)},emit:function(a){for(var u,s=arguments.length,l=new Array(s>1?s-1:0),f=1;f<s;f++)l[f-1]=arguments[f];(u=n.vm).emit.apply(u,[a].concat(l))},helper:{tidyFields:t,props:e}};return["on","once","off","set"].forEach(function(o){i[o]=function(){var a;(a=n.bus)["$".concat(o)].apply(a,arguments)}}),i.changeValue=i.changeField=i.setValue,i}function Cr(n){b(n.prototype,{initCache:function(){this.clearCacheAll()},clearCache:function(e){e.rule.cache||this.cache[e.id]&&((this.cache[e.id].use===!0||this.cache[e.id].parent)&&this.$handle.refresh(),this.cache[e.id]=null)},clearCacheAll:function(){this.cache={}},setCache:function(e,r,i){this.cache[e.id]={vnode:r,use:!1,parent:i,slot:e.rule.slot}},getCache:function(e){var r=this.cache[e.id];if(r)return r.use=!0,r.vnode}})}function ee(n){var t=n.replace(/(-[a-z])/g,function(e){return e.replace("-","").toLocaleUpperCase()});return It(t)}function It(n){return n.replace(n[0],n[0].toLowerCase())}function jt(n){return n==null?"":K(n)==="object"?JSON.stringify(n,null,2):String(n)}var wr=0;function Ce(){return"F"+Math.random().toString(36).substr(3,3)+Number("".concat(Date.now()).concat(++wr)).toString(36)}function ye(n,t,e){var r=n,i;return(t||"").split(".").forEach(function(o){i&&((!r[i]||K(r[i])!="object")&&(r[i]={}),r=r[i]),i=o}),r[i]=e,r}function Or(n){b(n.prototype,{initRender:function(){this.cacheConfig={}},getTypeSlot:function(e){var r=function i(o){if(o){var a=void 0;return e.rule.field&&(a=o.slots["field-"+ve(e.rule.field)]||o.slots["field-"+e.rule.field]),a||(a=o.slots["type-"+ve(e.type)]||o.slots["type-"+e.type]),a||i(o.setupState.parent)}};return r(this.vm)},render:function(){var e=this;if(this.vm.setupState.isShow){this.$manager.beforeRender();var r=we();return this.sort.forEach(function(i){e.renderSlot(r,e.$handle.ctxs[i])}),this.$manager.render(r)}},renderSlot:function(e,r,i){if(this.isFragment(r)){r.initProp(),this.mergeGlobal(r),r.initNone();var o=this.renderChildren(r.loadChildrenPending(),r),a=o.default;a&&e.setSlot(r.rule.slot,function(){return a()}),delete o.default,e.mergeBag(o)}else e.setSlot(r.rule.slot,this.renderCtx(r,i))},mergeGlobal:function(e){var r=this,i=this.$handle.options.global;i&&(this.cacheConfig[e.trueType]||(this.cacheConfig[e.trueType]=Yt(function(){var o=r.$handle.options.global;return Z({},[o["*"],o[e.originType]||o[e.type]||o[e.type]||{}])})),e.prop=Z({},[this.cacheConfig[e.trueType].value,e.prop]))},setOptions:function(e){var r=e.loadPending({key:"options",origin:e.prop.options,def:[]});e.prop.options=r,e.prop.optionsTo&&r&&ye(e.prop,e.prop.optionsTo,r)},deepSet:function(e){var r=e.rule.deep;r&&Object.keys(r).sort(function(i,o){return i.length<o.length?-1:1}).forEach(function(i){ye(e.prop,i,r[i])})},parseSide:function(e,r){return p.Object(e)?Z({props:{formCreateInject:r.prop.props.formCreateInject}},e):e},renderSides:function(e,r,i){var o=r[i?"rule":"prop"];return[this.renderRule(this.parseSide(o.prefix,r)),e,this.renderRule(this.parseSide(o.suffix,r))]},renderId:function(e,r){var i=this,o=this.$handle[r==="field"?"fieldCtx":"nameCtx"][e];return o?o.map(function(a){return i.renderCtx(a,a.parent)}):void 0},renderCtx:function(e,r){var i=this;try{if(e.type==="hidden")return;var o=e.rule;if(!this.cache[e.id]||this.cache[e.id].slot!==o.slot){var a;e.initProp(),this.mergeGlobal(e),e.initNone(),this.$manager.tidyRule(e),this.deepSet(e),this.setOptions(e),this.ctxProp(e);var u=e.prop;u.preview=!!(I(u,"preview")?u.preview:this.options.preview),u.props.formCreateInject=this.injectProp(e);var s=u.cache!==!1,l=u.preview;if(u.hidden){this.setCache(e,void 0,r);return}a=function(){for(var c=arguments.length,d=new Array(c),v=0;v<c;v++)d[v]=arguments[v];var g={rule:o,prop:u,preview:l,api:i.$handle.api,model:u.model||{},slotValue:d};d.length&&o.slotUpdate&&k(function(){return o.slotUpdate(g)});var $={},w=e.loadChildrenPending();e.parser.renderChildren?$=e.parser.renderChildren(w,e):e.parser.loadChildren!==!1&&($=i.renderChildren(w,e));var F=i.getTypeSlot(e),C;return F?(g.children=$,C=F(g)):C=l?e.parser.preview($,e):e.parser.render($,e),C=i.renderSides(C,e),!(!e.input&&p.Undef(u.native))&&u.native!==!0&&(C=i.$manager.makeWrap(e,C)),e.none&&(C=i.display(C)),s&&!Object.keys($).length&&i.setCache(e,function(){return C},r),C},this.setCache(e,a,r)}return function(){var f=i.getCache(e);if(f)return f.apply(void 0,arguments);if(i.cache[e.id])return;var c=i.renderCtx(e,e.parent);if(c)return c()}}catch(f){console.error(f);return}},getModelField:function(e){return e.rule.modelField||e.parser.modelField||this.fc.modelFields[this.vNode.aliasMap[e.type]]||this.fc.modelFields[e.type]||this.fc.modelFields[e.originType]||"modelValue"},display:function(e){var r=this;if(Array.isArray(e)){var i=[];return e.forEach(function(o){if(Array.isArray(o))return r.display(o);r.none(o)&&i.push(o)}),i}else return this.none(e)},none:function(e){if(e)return Array.isArray(e.props.style)?e.props.style.push({display:"none"}):e.props.style=[e.props.style,{display:"none"}],e},isFragment:function(e){return e.type==="fragment"||e.type==="template"},injectProp:function(e){var r=this,i=this.vm.setupState;i.ctxInject[e.id]||(i.ctxInject[e.id]={api:this.$handle.api,form:this.fc.create,subForm:function(u){r.$handle.addSubForm(e,u)},getSubForm:function(){return r.$handle.subForm[e.id]},options:[],children:[],preview:!1,field:e.field,rule:e.rule,input:e.input});var o=i.ctxInject[e.id];return b(o,{preview:e.prop.preview,options:e.prop.options,children:e.loadChildrenPending()}),o},ctxProp:function(e,r){var i=this,o=e.ref,a=e.key,u=e.rule;this.$manager.mergeProp(e,r),e.parser.mergeProp(e,r);var s=[{ref:o,key:u.key||"".concat(a,"fc"),slot:void 0,on:{vnodeMounted:function(d){d.el.__rule__=e.rule,i.onMounted(e,d.el)},"fc.el":function(d){e.exportEl=d,d&&((d.$el||d).__rule__=e.rule)}}}];if(!r&&e.input){var l=this.getModelField(e),f={callback:function(d){i.onInput(e,d)},value:this.$handle.getFormData(e)};s.push({on:j({},"update:".concat(l),f.callback),props:j({},l,f.value)}),e.prop.model=f}return X(s,e.prop),e.prop},onMounted:function(e,r){e.el=this.vm.refs[e.ref]||r,e.parser.mounted(e),this.$handle.effect(e,"mounted")},onInput:function(e,r){this.$handle.onInput(e,r)},renderChildren:function(e,r){var i=this;if(!p.trueArray(e))return{};var o=we();return e.map(function(a){if(a){if(p.String(a))return o.setSlot(null,a);if(a.__fc__)return i.renderSlot(o,a.__fc__,r);a.type&&J(function(){i.$handle.loadChildren(e,r),i.$handle.refresh()})}}),o.getSlots()},defaultRender:function(e,r){var i=e.prop;return i.component?this.vNode.makeComponent(i.component,i,r):this.vNode[e.type]?this.vNode[e.type](i,r):this.vNode[e.originType]?this.vNode[e.originType](i,r):this.vNode.make(It(e.originType),i,r)},renderRule:function(e,r,i){var o=this;if(e){if(p.String(e))return e;var a;if(i)a=e.type;else if(a=e.is,e.type){a=ee(e.type);var u=this.vNode.aliasMap[a];u&&(a=ee(u))}if(a){var s=we();p.trueArray(e.children)&&e.children.forEach(function(f){f&&s.setSlot(f==null?void 0:f.slot,function(){return o.renderRule(f)})});var l=_({},e);return delete l.type,delete l.is,this.vNode.make(a,l,s.mergeBag(r).getSlots())}}}})}var Sr=1;function Ue(n){b(this,{$handle:n,fc:n.fc,vm:n.vm,$manager:n.$manager,vNode:new n.fc.CreateNode(n.vm),id:Sr++}),Et(this,{options:function(){return n.options},sort:function(){return n.sort}}),this.initCache(),this.initRender()}Cr(Ue);Or(Ue);function Fr(n){b(n.prototype,{parseInjectEvent:function(e,r){var i=e.inject||this.options.injectEvent;return this.parseEventLst(e,r,i)},parseEventLst:function(e,r,i,o){var a=this;return Object.keys(r).forEach(function(u){var s=a.parseEvent(e,r[u],i,o);s&&(r[u]=s)}),r},parseEvent:function(e,r,i,o){if(p.Function(r)&&(i!==!1&&!p.Undef(i)||r.__inject))return this.inject(e,r,i);if(!o&&Array.isArray(r)&&r[0]&&(p.String(r[0])||p.Function(r[0])))return this.parseEventLst(e,r,i,!0);if(p.String(r)){var a=fe(r);if(a&&r!==a)return a.__inject?this.parseEvent(e,a,i,!0):a}},parseEmit:function(e){var r=this,i={},o=e.rule,a=o.emitPrefix,u=o.field,s=o.name,l=o.inject,f=o.emit||[];if(p.trueArray(f)){var c=a||u||s;c&&f.forEach(function(d){if(d){var v;p.Object(d)&&(v=d.inject,d=d.name);var g=ve("".concat(c,"-").concat(d)),$=function(){for(var C,R,P,D=arguments.length,A=new Array(D),G=0;G<D;G++)A[G]=arguments[G];(C=r.vm).emit.apply(C,[g].concat(A)),(R=r.vm).emit.apply(R,["emit-event",g].concat(A)),(P=r.bus).$emit.apply(P,[g].concat(A))};if($.__emit=!0,!v&&l===!1)i[d]=$;else{var w=v||l||r.options.injectEvent;i[d]=p.Undef(w)?$:r.inject(o,$,w)}}})}return e.computed.on=i,i},getInjectData:function(e,r){var i=this.vm.props,o=i.option,a=i.rule;return{$f:this.api,api:this.api,rule:a,self:e.__origin__,option:o,inject:r}},inject:function(e,r,i){if(r.__origin){if(this.watching&&!this.loading)return r;r=r.__origin}var o=this,a=function(){for(var s=o.getInjectData(e,i),l=arguments.length,f=new Array(l),c=0;c<l;c++)f[c]=arguments[c];return s.args=[].concat(f),f.unshift(s),r.apply(this,f)};return a.__origin=r,a.__json=r.__json,a}})}var nt=["hook:updated","hook:mounted"];function Vr(n){b(n.prototype,{usePage:function(){var e=this,r=this.options.page;if(r){var i=25,o=Rr(this.rules);p.Object(r)&&(r.first&&(i=parseInt(r.first,10)||i),r.limit&&(o=parseInt(r.limit,10)||o)),b(this,{first:i,limit:o,pageEnd:this.rules.length<=i}),this.bus.$on("page-end",function(){return e.vm.emit("page-end",e.api)}),this.pageLoad()}},pageLoad:function(){var e=this,r=function i(){e.pageEnd?(e.bus.$off(nt,i),e.bus.$emit("page-end")):(e.first+=e.limit,e.pageEnd=e.rules.length<=e.first,e.loadRule(),e.refresh())};this.bus.$on(nt,r)}})}function Rr(n){return n.length<31?31:Math.ceil(n.length/3)}function Er(n){b(n.prototype,{clearNextTick:function(){this.nextTick&&clearTimeout(this.nextTick),this.nextTick=null},bindNextTick:function(e){var r=this;this.clearNextTick(),this.nextTick=setTimeout(function(){e(),r.nextTick=null},10)},render:function(){return++this.loadedId,this.vm.setupState.unique>0?this.$render.render():(this.vm.setupState.unique=1,[])}})}function Ar(n){var t=!(p.Undef(n.prop.display)||n.prop.display);return n.parent&&n.parent.none||t}function Pr(n){Object.defineProperties(n.origin,{__fc__:Vt(ue(n),!0)})}function kt(n,t,e){var r=Ce(),i=!!t.field;b(this,{id:r,ref:r,wrapRef:r+"fi",rule:t,origin:t.__origin__||t,name:t.name,pending:{},none:!1,watch:[],linkOn:[],root:[],ctrlRule:[],parent:null,cacheConfig:null,prop:_({},t),computed:{},payload:{},refRule:{},input:i,el:void 0,exportEl:void 0,defaultValue:i?Q(e):void 0,field:t.field||void 0}),this.updateType(),this.updateKey(),Pr(this),this.update(n,!0)}b(kt.prototype,{loadChildrenPending:function(){var t=this,e=this.rule.children||[];return Array.isArray(e)?e:this.loadPending({key:"children",origin:e,def:[],onLoad:function(i){t.$handle&&t.$handle.loadChildren(i,t)},onUpdate:function(i,o){t.$handle&&(i===o?t.$handle.loadChildren(i,t):t.$handle.updateChildren(t,i,o))},onReload:function(i){t.$handle?t.$handle.updateChildren(t,[],i):delete t.pending.children}})},loadPending:function(t){var e=this,r=t.key,i=t.origin,o=t.def,a=t.onLoad,u=t.onReload,s=t.onUpdate;if(this.pending[r]&&this.pending[r].origin===i)return this.getPending(r,o);delete this.pending[r];var l=i;if(p.Function(i)){var f=k(function(){return i({rule:e.rule,api:e.$api,update:function(d){var v=d||o,g=e.getPending(r,o);e.setPending(r,i,v),s&&s(v,g)},reload:function(){var d=e.getPending(r,o);delete e.pending[r],u&&u(d),e.$api&&e.$api.sync(e.rule)}})});f&&p.Function(f.then)?(f.then(function(c){var d=c||o;e.setPending(r,i,d),a&&a(d),e.$api&&e.$api.sync(e.rule)}).catch(function(c){console.error(c)}),l=o,this.setPending(r,i,l)):(l=f||o,this.setPending(r,i,l),a&&a(l))}return l},getPending:function(t,e){return this.pending[t]&&this.pending[t].value||e},setPending:function(t,e,r){this.pending[t]={origin:e,value:ne(r)}},effectData:function(t){return this.payload[t]||(this.payload[t]={}),this.payload[t]},clearEffectData:function(t){t===void 0?this.payload={}:delete this.payload[t]},updateKey:function(t){this.key=Ce(),t&&this.parent&&this.parent.updateKey(t)},updateType:function(){this.originType=this.rule.type,this.type=ee(this.rule.type)},setParser:function(t){this.parser=t,t.init(this)},initProp:function(){var t=this,e=_({},this.rule);delete e.children,this.prop=Z({},[e].concat(S(Object.keys(this.payload).map(function(r){return t.payload[r]})),[this.computed]))},initNone:function(){this.none=Ar(this)},check:function(t){return this.vm===t.vm},unwatch:function(){this.watch.forEach(function(t){return t()}),this.watch=[],this.refRule={}},unlink:function(){this.linkOn.forEach(function(t){return t()}),this.linkOn=[]},link:function(){this.unlink(),this.$handle.appendLink(this)},watchTo:function(){this.$handle.watchCtx(this)},delete:function(){var t=void 0;this.unwatch(),this.unlink(),this.rmCtrl(),b(this,{deleted:!0,prop:_({},this.rule),computed:{},el:t,$handle:t,$render:t,$api:t,vm:t,vNode:t,parent:null,cacheConfig:null,none:!1})},rmCtrl:function(){this.ctrlRule.forEach(function(t){return t.__fc__&&t.__fc__.rm()}),this.ctrlRule=[]},rm:function(){var t=this,e=function(){var i=t.root.indexOf(t.origin);i>-1&&(t.root.splice(i,1),t.$handle&&t.$handle.refresh())};if(this.deleted){e();return}this.$handle.noWatch(function(){t.$handle.deferSyncValue(function(){t.rmCtrl(),e(),t.$handle.rmCtx(t),b(t,{root:[]})},t.input)})},update:function(t,e){b(this,{deleted:!1,$handle:t,$render:t.$render,$api:t.api,vm:t.vm,trueType:t.getType(this.originType),vNode:t.$render.vNode,updated:!1,cacheValue:this.rule.value}),!e&&this.unwatch(),this.watchTo(),this.link()}});var _e={"==":function(t){return function(e){return e===t}},"!=":function(t){return function(e){return e!==t}},"<>":function(t){return function(e){return e!==t}},">":function(t){return function(e){return e>t}},">=":function(t){return function(e){return e>=t}},"<":function(t){return function(e){return e<t}},"<=":function(t){return function(e){return e<=t}},in:function(t){return function(e){return t&&t.indexOf&&t.indexOf(e)>-1}},on:function(t){return function(e){return e&&e.indexOf&&e.indexOf(t)>-1}},notIn:function(t){return function(e){return!_e.in(t)(e)}},notOn:function(t){return function(e){return!_e.on(t)(e)}},between:function(t){return function(e){return e>t[0]&&e<t[1]}},notBetween:function(t){return function(e){return e<t[0]||e>t[1]}}};function Ir(n){b(n.prototype,{nextRefresh:function(e){var r=this,i=this.loadedId;J(function(){i===r.loadedId&&(e?e():r.refresh())})},parseRule:function(e){var r=this,i=et(e);return Object.defineProperties(i,{__origin__:Vt(e,!0)}),jr(i),this.appendValue(i),[i,i.prefix,i.suffix].forEach(function(o){o&&r.loadFn(o,i)}),this.loadCtrl(i),i.update&&(i.update=fe(i.update)),i},loadFn:function(e,r){var i=this;["on","props","deep"].forEach(function(o){e[o]&&i.parseInjectEvent(r,e[o])})},loadCtrl:function(e){e.control&&e.control.forEach(function(r){r.handle&&(r.handle=fe(r.handle))})},syncProp:function(e){var r=this,i=e.rule;p.trueArray(i.sync)&&X([{on:i.sync.reduce(function(o,a){return o["update:".concat(a)]=function(u){i.props[a]=u,r.vm.emit("sync",a,u,i,r.fapi)},o},{})}],e.computed)},loadRule:function(){var e=this;this.cycleLoad=!1,this.loading=!0,this.pageEnd&&this.bus.$emit("load-start"),this.deferSyncValue(function(){if(e._loadRule(e.rules),e.loading=!1,e.cycleLoad&&e.pageEnd)return e.loadRule();e.syncForm(),e.pageEnd&&e.bus.$emit("load-end"),e.vm.setupState.renderRule()})},loadChildren:function(e,r){if(this.cycleLoad=!1,this.loading=!0,this.bus.$emit("load-start"),this._loadRule(e,r),this.loading=!1,this.cycleLoad)return this.loadRule();this.syncForm(),this.bus.$emit("load-end"),this.$render.clearCache(r)},_loadRule:function(e,r){var i=this,o=function u(s){var l=e[s-1];if(!l||!l.__fc__)return s>0?u(s-1):-1;var f=i.sort.indexOf(l.__fc__.id);return f>-1?f:u(s-1)},a=function(s,l){p.trueArray(s)&&i._loadRule(s,l)};e.map(function(u,s){if(!(r&&!p.Object(u))&&!(!i.pageEnd&&!r&&s>=i.first)){if(u.__fc__&&u.__fc__.root===e&&i.ctxs[u.__fc__.id])return a(u.__fc__.loadChildrenPending(),u.__fc__),u.__fc__;var l=et(u),f=function(){return!!(l.field&&i.fieldCtx[l.field]&&i.fieldCtx[l.field][0]!==u.__fc__)};i.ruleEffect(l,"init",{repeat:f()}),f()&&i.vm.emit("repeat-field",u,i.api);var c,d=!1,v=!!u.__fc__,g=l.value;if(v){c=u.__fc__,g=c.defaultValue;var $=!c.check(i);if(c.deleted){if($){if(rt(c))return;c.update(i)}}else if($){if(rt(c))return;e[s]=u=u._clone?u._clone():Ne(u),c=null,d=!0}}if(c)c.originType!==c.rule.type&&(c.updateType(),i.bindParser(c)),i.appendValue(c.rule);else{var w=i.parseRule(u);c=new kt(i,w,v?g:w.value),i.bindParser(c)}i.parseEmit(c),i.syncProp(c),c.parent=r||null,c.root=e,i.setCtx(c),!d&&!v&&i.effect(c,"load"),i.effect(c,"created");var F=c.loadChildrenPending();if(c.parser.loadChildren===!1||a(F,c),!r){var C=o(s);C>-1||!s?i.sort.splice(C+1,0,c.id):i.sort.push(c.id)}var R=c.rule;return c.updated||(c.updated=!0,p.Function(R.update)&&i.bus.$once("load-end",function(){i.refreshUpdate(c,R.value,"init")}),i.effect(c,"loaded")),i.refreshControl(c)&&(i.cycleLoad=!0),c}})},refreshControl:function(e){return e.input&&e.rule.control&&this.useCtrl(e)},useCtrl:function(e){var r=this,i=kr(e),o=[],a=this.api;if(!i.length)return!1;for(var u=function(v){var g=i[v],$=g.handle||(_e[g.condition||"=="]||_e["=="])(g.value);if(!p.trueArray(g.rule))return"continue";var w=_(_({},g),{},{valid:k(function(){return $(e.rule.value,a)}),ctrl:xr(e,g.rule),isHidden:p.String(g.rule[0])});if(w.valid&&w.ctrl||!w.valid&&!w.ctrl&&!w.isHidden)return"continue";o.push(w)},s=0;s<i.length;s++)var l=u(s);if(!o.length)return!1;var f=[],c=!1;return this.deferSyncValue(function(){o.reverse().forEach(function(d){var v=d.isHidden,g=d.valid,$=d.rule,w=d.prepend,F=d.append,C=d.child,R=d.ctrl,P=d.method;if(v){g?e.ctrlRule.push({__ctrl:!0,children:$,valid:g}):e.ctrlRule.splice(e.ctrlRule.indexOf(R),1),f[g?"push":"unshift"](function(){P==="disabled"?r.api.disabled(!g,$):P==="display"?r.api.display(g,$):P==="required"?($.forEach(function(G){r.api.setEffect(G,"required",g)}),g||r.api.clearValidateState($)):r.api.hidden(!g,$)});return}if(g){c=!0;var D={type:"fragment",native:!0,__ctrl:!0,children:$};e.ctrlRule.push(D),r.bus.$once("load-start",function(){w?a.prepend(D,w,C):F||C?a.append(D,F||e.id,C):e.root.splice(e.root.indexOf(e.origin)+1,0,D)})}else{e.ctrlRule.splice(e.ctrlRule.indexOf(R),1);var A=ge(R);A&&A.rm()}})}),f.length&&J(function(){f.forEach(function(d){return d()})}),this.vm.emit("control",e.origin,this.api),this.effect(e,"control"),c},reloadRule:function(e){return this._reloadRule(e)},_reloadRule:function(e){var r=this;e||(e=this.rules);var i=_({},this.ctxs);this.clearNextTick(),this.initData(e),this.fc.rules=e,this.deferSyncValue(function(){r.bus.$once("load-end",function(){Object.keys(i).filter(function(o){return r.ctxs[o]===void 0}).forEach(function(o){return r.rmCtx(i[o])}),r.$render.clearCacheAll()}),r.reloading=!0,r.loadRule(),r.reloading=!1,r.refresh(),r.bus.$emit("reloading",r.api)}),this.bus.$off("next-tick",this.nextReload),this.bus.$once("next-tick",this.nextReload),this.bus.$emit("update",this.api)},refresh:function(){this.vm.setupState.refresh()}})}function jr(n){var t=At();return Object.keys(t).forEach(function(e){I(n,e)||(n[e]=t[e])}),n}function kr(n){var t=n.rule.control||[];return p.Object(t)?[t]:t}function xr(n,t){for(var e=0;e<n.ctrlRule.length;e++){var r=n.ctrlRule[e];if(r.children===t)return r}}function rt(n){return!!n.rule.__ctrl}function Br(n){b(n.prototype,{setValue:function(e,r,i,o){e.deleted||(e.rule.value=r,this.changeStatus=!0,this.nextRefresh(),this.$render.clearCache(e),this.setFormData(e,i),this.syncValue(),this.valueChange(e,r),this.vm.emit("change",e.field,r,e.origin,this.api,o||!1),this.effect(e,"value"))},onInput:function(e,r){var i;e.input&&(this.isQuote(e,i=e.parser.toValue(r,e))||this.isChange(e,r))&&this.setValue(e,i,r)},setFormData:function(e,r){N(this.formData,e.id,r)},getFormData:function(e){return this.formData[e.id]},syncForm:function(){var e=this,r=ne({});this.fields().reduce(function(i,o){var a=e.getCtx(o);return i[o]=z(a.rule,"value"),i},r),this.form=r,this.syncValue()},appendValue:function(e){!e.field||!I(this.appendData,e.field)||(e.value=this.appendData[e.field],delete this.appendData[e.field])},addSubForm:function(e,r){this.subForm[e.id]=r},deferSyncValue:function(e,r){this.deferSyncFn||(this.deferSyncFn=e),this.deferSyncFn.sync||(this.deferSyncFn.sync=r),k(e),this.deferSyncFn===e&&(this.deferSyncFn=null,e.sync&&this.syncValue())},syncValue:function(){if(this.deferSyncFn)return this.deferSyncFn.sync=!0;this.vm.setupState.updateValue(_({},this.form))},isChange:function(e,r){return JSON.stringify(this.getFormData(e),it)!==JSON.stringify(r,it)},isQuote:function(e,r){return(p.Object(r)||Array.isArray(r))&&r===e.rule.value},refreshUpdate:function(e,r,i){var o=this;if(p.Function(e.rule.update)){var a=k(function(){return e.rule.update(r,e.origin,o.api,{origin:i||"change"})});if(a===void 0)return;e.rule.hidden=a===!0}},valueChange:function(e,r){this.refreshRule(e,r),this.bus.$emit("change-"+e.field,r)},refreshRule:function(e,r,i){this.refreshControl(e)&&(this.$render.clearCacheAll(),this.loadRule(),this.bus.$emit("update",this.api),this.refresh()),this.refreshUpdate(e,r,i)},appendLink:function(e){var r=this,i=e.rule.link;p.trueArray(i)&&i.forEach(function(o){var a=function(){return r.refreshRule(e,e.rule.value,"link")};r.bus.$on("change-"+o,a),e.linkOn.push(function(){return r.bus.$off("change-"+o,a)})})},fields:function(){return Object.keys(this.fieldCtx)}})}function it(n,t){return typeof t=="function"?""+t:t}var xt={init:function(t){},toFormValue:function(t,e){return t},toValue:function(t,e){return t},mounted:function(t){},render:function(t,e){return e.$render.defaultRender(e,t)},preview:function(t,e){return this.render(t,e)},mergeProp:function(t){}},Dr={sum:function(t){if(Array.isArray(t)){var e=0;return t.map(function(r){return e+=r||0}),e}},column:function(t,e){return Array.isArray(t)?t.map(function(r){return r[e]}):[]},get:function(t,e,r){for(var i=e.split("."),o=t,a=0;a<i.length;a++)if(I(o,i[a]))o=o[i[a]];else return r===void 0?0:r;return o}},Tr=["field","value","vm","template","name","config","control","inject","sync","payload","optionsTo","update","slotUpdate","computed","component","cache"];function Mr(n){b(n.prototype,{getCtx:function(e){return this.getFieldCtx(e)||this.getNameCtx(e)[0]||this.ctxs[e]},getCtxs:function(e){return this.fieldCtx[e]||this.nameCtx[e]||(this.ctxs[e]?[this.ctxs[e]]:[])},setIdCtx:function(e,r,i){var o="".concat(i,"Ctx");this[o][r]?this[o][r].push(e):this[o][r]=[e]},rmIdCtx:function(e,r,i){var o="".concat(i,"Ctx"),a=this[o][r];if(!a)return!1;var u=a.splice(a.indexOf(e)>>>0,1).length>0;return a.length||delete this[o][r],u},getFieldCtx:function(e){return(this.fieldCtx[e]||[])[0]},getNameCtx:function(e){return this.nameCtx[e]||[]},setCtx:function(e){var r=e.id,i=e.field,o=e.name,a=e.rule;this.ctxs[r]=e,o&&this.setIdCtx(e,o,"name"),e.input&&(this.setIdCtx(e,i,"field"),this.setFormData(e,e.parser.toFormValue(a.value,e)),this.isMounted&&!this.reloading&&this.vm.emit("change",e.field,a.value,e.origin,this.api))},getParser:function(e){var r=this.fc.parsers;return r[e.originType]||r[ee(e.type)]||r[e.trueType]||xt},bindParser:function(e){e.setParser(this.getParser(e))},getType:function(e){var r=this.fc.CreateNode.aliasMap,i=r[e]||r[ee(e)]||e;return ee(i)},noWatch:function(e){this.noWatchFn||(this.noWatchFn=e),k(e),this.noWatchFn===e&&(this.noWatchFn=null)},watchCtx:function(e){var r=this,i=Ot();if(i.filter(function(a){return a[0]!=="_"&&a[0]!=="$"&&Tr.indexOf(a)===-1}).forEach(function(a){var u=z(e.rule,a),s=a==="children";e.refRule[a]=u,e.watch.push(U(s?function(){return p.Function(u.value)?u.value:S(u.value||[])}:function(){return u.value},function(l,f){var c=u.value;if(!r.isBreakWatch()){if(s&&e.parser.loadChildren===!1){r.$render.clearCache(e),r.nextRefresh();return}if(r.watching=!0,a==="link"){e.link();return}else["props","on","deep"].indexOf(a)>-1?(r.parseInjectEvent(e.rule,c||{}),a==="props"&&e.input&&r.setFormData(e,e.parser.toFormValue(e.rule.value,e))):a==="emit"?r.parseEmit(e):["prefix","suffix"].indexOf(a)>-1?c&&r.loadFn(c,e.rule):a==="type"?(e.updateType(),r.bindParser(e)):s&&(p.Function(f)&&(f=e.getPending("children",[])),p.Function(c)&&(c=e.loadChildrenPending()),r.updateChildren(e,c,f));r.$render.clearCache(e),r.refresh(),r.watching=!1}},{deep:!s,sync:s}))}),e.input){var o=z(e.rule,"value");e.watch.push(U(function(){return o.value},function(){var a=e.parser.toFormValue(o.value,e);r.isChange(e,a)&&r.setValue(e,o.value,a,!0)})),this.bus.$once("load-end",function(){var a=z(e.rule,"computed");e.watch.push(U(function(){var u=a.value;if(u){var s;return p.Function(u)?s=function(){return u(r.api.form,r.api)}:s=function(){return new Function("_","with(this){ return ".concat(u," }")).call(r.api.form,Dr)},k(s,void 0)}},function(u){o.value=u},{immediate:!!a.value}))})}this.watchEffect(e)},updateChildren:function(e,r,i){var o=this;this.deferSyncValue(function(){i&&i.forEach(function(a){(r||[]).indexOf(a)===-1&&a&&!p.String(a)&&a.__fc__&&a.__fc__.parent===e&&a.__fc__.root===i&&o.rmCtx(a.__fc__)}),p.trueArray(r)&&(o.loadChildren(r,e),o.bus.$emit("update",o.api))})},rmSub:function(e){var r=this;p.trueArray(e)&&e.forEach(function(i){i&&i.__fc__&&r.rmCtx(i.__fc__)})},rmCtx:function(e){var r=this;if(!e.deleted){var i=e.id,o=e.field,a=e.input,u=e.name;se(this.ctxs,i),se(this.formData,i),se(this.subForm,i),se(this.vm.setupState.ctxInject,i),a&&this.rmIdCtx(e,o,"field"),u&&this.rmIdCtx(e,u,"name"),a&&!I(this.fieldCtx,o)&&se(this.form,o),this.deferSyncValue(function(){if(!r.reloading){if(e.parser.loadChildren!==!1){var l=e.getPending("children",e.rule.children);p.trueArray(l)&&l.forEach(function(f){return f.__fc__&&r.rmCtx(f.__fc__)})}e.root===r.rules&&r.vm.setupState.renderRule()}},a);var s=this.sort.indexOf(i);return s>-1&&this.sort.splice(s,1),this.$render.clearCache(e),e.delete(),this.effect(e,"deleted"),a&&!this.fieldCtx[o]&&this.vm.emit("remove-field",o,e.rule,this.api),e.rule.__ctrl||this.vm.emit("remove-rule",e.rule,this.api),e}}})}function Nr(n){b(n.prototype,{mounted:function(){var e=this,r=function(){e.isMounted=!0,e.lifecycle("mounted")};this.pageEnd?r():this.bus.$once("page-end",r)},lifecycle:function(e){var r=this,i=this.options[e];p.Function(i)&&k(function(){return i(r.api)}),this.vm.emit(e,this.api)}})}function Lr(n){b(n.prototype,{useProvider:function(){var e=this,r=this.fc.providers;Object.keys(r).forEach(function(i){var o=r[i];p.Function(o)&&(o=o(e.fc)),o._c=Hr(o),e.onEffect(o),e.providers[i]=o})},onEffect:function(e){var r=this,i=[];(e._c||["*"]).forEach(function(o){var a=o==="*"?"*":r.getType(o);i.indexOf(a)>-1||(i.push(a),r.bus.$on("p:".concat(e.name,":").concat(a,":").concat(e.input?1:0),function(u,s){e[u]&&e[u].apply(e,S(s))}))}),e._used=i},watchEffect:function(e){var r=this,i={required:function(){var a,u;return(I(e.rule,"$required")?e.rule.$required:(a=e.rule)===null||a===void 0||(u=a.effect)===null||u===void 0?void 0:u.required)||!1}};Object.keys(e.rule.effect||{}).forEach(function(o){i[o]=function(){return e.rule.effect[o]}}),Object.keys(e.rule).forEach(function(o){o[0]==="$"&&(i[o.substr(1)]=function(){return e.rule[o]})}),Object.keys(i).forEach(function(o){e.watch.push(U(i[o],function(a){r.effect(e,"watch",j({},o,a))},{deep:!0}))})},ruleEffect:function(e,r,i){this.emitEffect({rule:e,input:!!e.field,type:this.getType(e.type)},r,i)},effect:function(e,r,i){this.emitEffect({rule:e.rule,input:e.input,type:e.trueType,ctx:e,custom:i},r)},getEffect:function(e,r){if(I(e,"$"+r))return e["$"+r];if(I(e,"effect")&&I(e.effect,r))return e.effect[r]},emitEffect:function(e,r,i){var o=this,a=e.ctx,u=e.rule,s=e.input,l=e.type,f=e.custom;if(!(!l||["fcFragment","fragment"].indexOf(l)>-1)){var c=f||Object.keys(u).reduce(function(d,v){return v[0]==="$"&&(d[v.substr(1)]=u[v]),d},_({},u.effect||{}));Object.keys(c).forEach(function(d){var v=o.providers[d];if(!(!v||v.input&&!s)){var g;if(!v._c)g="*";else if(v._used.indexOf(l)>-1)g=l;else return;var $=_({value:c[d],getValue:function(){return o.getEffect(u,d)}},i||{});a&&($.getProp=function(){return a.effectData(d)},$.clearProp=function(){return a.clearEffectData(d)},$.mergeProp=function(w){return Z($.getProp(),[w])},$.id=a.id),o.bus.$emit("p:".concat(d,":").concat(g,":").concat(v.input?1:0),r,[$,u,o.api])}})}}})}function Ur(n){return n.filter(function(t,e,r){return r.indexOf(t,0)===e})}function Hr(n){var t=n.components;if(Array.isArray(t)){var e=Ur(t.filter(function(r){return r!=="*"}));return e.length?e:!1}else return p.String(t)?[t]:!1}function q(n){var t=this;Et(this,{options:function(){return n.options.value||{}},bus:function(){return n.bus}}),b(this,{fc:n,vm:n.vm,watching:!1,loading:!1,reloading:!1,noWatchFn:null,deferSyncFn:null,isMounted:!1,formData:ne({}),subForm:{},form:ne({}),appendData:{},providers:{},cycleLoad:null,loadedId:1,nextTick:null,changeStatus:!1,pageEnd:!0,nextReload:function(){t.lifecycle("reload")}}),this.initData(n.rules),this.$manager=new n.manager(this),this.$render=new Ue(this),this.api=n.extendApi($r(this),this)}b(q.prototype,{initData:function(t){b(this,{ctxs:{},fieldCtx:{},nameCtx:{},sort:[],rules:t})},init:function(){this.appendData=_(_(_({},this.options.formData||{}),this.fc.vm.props.modelValue||{}),this.appendData),this.useProvider(),this.usePage(),this.loadRule(),this.$manager.__init()},isBreakWatch:function(){return this.loading||this.noWatchFn||this.reloading}});Fr(q);Vr(q);Er(q);Ir(q);Br(q);Mr(q);Nr(q);Lr(q);function zr(n,t,e){var r="fail to ".concat(n," ").concat(e.status,"'"),i=new Error(r);return i.status=e.status,i.url=n,i}function ot(n){var t=n.responseText||n.response;if(!t)return t;try{return JSON.parse(t)}catch{return t}}function Yr(n){if(!(typeof XMLHttpRequest>"u")){var t=new XMLHttpRequest,e=n.action;t.onerror=function(a){n.onError(a)},t.onload=function(){if(t.status<200||t.status>=300)return n.onError(zr(e,n,t),ot(t));n.onSuccess(ot(t))},t.open(n.method||"get",e,!0);var r;n.data&&((n.dataType||"").toLowerCase()!=="json"?(r=new FormData,Object.keys(n.data).map(function(o){r.append(o,n.data[o])})):(r=JSON.stringify(n.data),t.setRequestHeader("content-type","application/json"))),n.withCredentials&&"withCredentials"in t&&(t.withCredentials=!0);var i=n.headers||{};Object.keys(i).forEach(function(o){i[o]!==null&&t.setRequestHeader(o,i[o])}),t.send(r)}}var qr="fcFragment",Se=Y({name:qr,inheritAttrs:!1,props:["vnode"],render:function(){return this.vnode}});function Wr(n){return Object.keys(n).map(function(t){var e=n[t],r=nn(t);if(r)return[r,e.value,e.arg,e.modifiers]}).filter(function(t){return!!t})}function at(n,t){var e=n.directives;return e?(Array.isArray(e)||(e=[e]),Wt(t,e.reduce(function(r,i){return r.concat(Wr(i))},[]))):t}function Jr(){var n={};function t(){}return b(t.prototype,{make:function(r,i,o){return at(i,this.h(r,tt(i),o))},makeComponent:function(r,i,o){try{return at(i,y(r,tt(i),o))}catch(a){return console.error(a),y("")}},h:function(r,i,o){var a=Pe().appContext.config.isNativeTag(r);a&&delete i.formCreateInject;try{return y(a?r:V(r),i,o)}catch(u){return console.error(u),y("")}},aliasMap:n}),b(t,{aliasMap:n,alias:function(r,i){n[r]=i},use:function(r){Object.keys(r).forEach(function(i){var o=ve(i),a=jt(i).toLocaleLowerCase(),u=r[i];[i,o,a].forEach(function(s){t.alias(i,u),t.prototype[s]=function(l,f){return this.make(u,l,f)}})})}}),t}function Kr(n){var t=function(e){on(i,e);var r=ln(i);function i(){return rn(this,i),r.apply(this,arguments)}return i}(Bt);return Object.assign(t.prototype,n),t}function Bt(n){b(this,{$handle:n,vm:n.vm,options:{},ref:"fcForm",mergeOptionsRule:{normal:["form","row","info","submitBtn","resetBtn"]}}),this.updateKey(),this.init()}b(Bt.prototype,{__init:function(){var t=this;this.$render=this.$handle.$render,this.$r=function(){var e;return(e=t.$render).renderRule.apply(e,arguments)}},updateKey:function(){this.key=Ce()},init:function(){},update:function(){},beforeRender:function(){},form:function(){return this.vm.refs[this.ref]},mergeOptions:function(t,e){var r=this;return X(t.map(function(i){return r.tidyOptions(i)}),e,this.mergeOptionsRule)},updateOptions:function(t){this.options=this.mergeOptions([t],this.getDefaultOptions()),this.update()},tidyOptions:function(t){return t},tidyRule:function(t){},mergeProp:function(t){},getDefaultOptions:function(){return{}},render:function(t){}});var Gr=function(t){var e={name:"loadData",_fn:[],created:function(i,o,a){this.deleted(i);var u=L(i.getValue()),s=[];u.forEach(function(l){if(l){var f=function c(){l.watch!==!1&&(t.bus.$off("p.loadData."+l.attr,c),t.bus.$once("p.loadData."+l.attr,c));var d=void 0;l.attr&&(d=t.loadData[l.attr]||l.default,l.copy&&(d=Q(d))),ye(i.getProp(),l.to||"options",d),a.sync(o)};s.push(function(){return t.bus.$off("p.loadData."+l.attr,f)}),f()}}),this._fn[i.id]=s},deleted:function(i){this._fn[i.id]&&this._fn[i.id].forEach(function(o){o()}),i.clearProp()}};return e.watch=e.created,e},De={name:"componentValidate",load:function(t,e,r){var i=t.getValue();i?t.getProp().validate=[{validator:function(){var a=ge(e);if(a){for(var u=arguments.length,s=new Array(u),l=0;l<u;l++)s[l]=arguments[l];return r.exec.apply(r,[a.id,i===!0?"formCreateValidate":i].concat(s,[{attr:t,rule:e,api:r}]))}}}]:(t.clearProp(),r.clearValidateState([e.field]))},watch:function(){De.load.apply(De,arguments)}},Xr=function(t){function e(i){return p.String(i)&&(i={action:i,to:"options"}),i}function r(i,o,a){var u=i.value,s=function(v){v===void 0?(i.clearProp(),a.sync(o)):ye(i.getProp(),u.to||"options",v)};if(p.Function(u)&&(u=u(o,a)),u=e(u),!u||!u.action){s(void 0);return}u.to||(u.to="options");var l=u.onError,f=function(){if(!i.getValue())return i.clearProp(),a.sync(o),!0},c=_(_({headers:{}},u),{},{onSuccess:function(v,g){if(!f()){var $=function(F){return g?F:F.data};p.Function(u.parse)?$=u.parse:u.parse&&p.String(u.parse)&&($=function(F){return u.parse.split(".").forEach(function(C){F&&(F=F[C])}),F}),s($(v,o,a)),a.sync(o)}},onError:function(v){s(void 0),!f()&&(l||function(g){return Me(g.message||"fetch fail "+u.action)})(v,o,a)}});if(t.options.beforeFetch&&k(function(){return t.options.beforeFetch(c,{rule:o,api:a})}),p.Function(u.action)){u.action(o,a).then(function(d){c.onSuccess(d,!0)}).catch(function(d){c.onError(d)});return}k(function(){return t.create.fetch(c,{inject:i,rule:o,api:a})})}return{name:"fetch",loaded:function(){r.apply(void 0,arguments)},watch:function(){r.apply(void 0,arguments)}}},Qr={fetch:Xr,loadData:Gr,componentValidate:De},Zr="html",ei={name:Zr,loadChildren:!1,render:function(t,e){return e.prop.props.innerHTML=t.default(),e.vNode.make(e.prop.props.tag||"div",e.prop)},renderChildren:function(t){return{default:function(){return t.filter(function(r){return p.String(r)}).join("")}}}};function ti(n,t){var e;return arguments.length===2?(e=arguments[1],t=e[n]):e=arguments[2],{id:t,prop:e}}function Fe(){return ti.apply(void 0,["name"].concat(Array.prototype.slice.call(arguments)))}function ni(n){var t=n.key||[],e=n.array||[],r=n.normal||[];ke.push.apply(ke,S(t)),he.push.apply(he,S(e)),me.push.apply(me,S(r)),Pt([].concat(S(t),S(e),S(r)))}var ri=1,M={};function Dt(n){var t=j({},Se.name,Se),e={},r={},i={},o=[],a=_({},Qr),u=br(),s={global:{}},l={},f=Jr();ni(n.attrs||{});function c(h){var m=M[h];if(Array.isArray(m))return m.map(function(O){return O.api()});if(m)return m.api()}function d(h){o.push(h)}function v(){var h=Fe.apply(void 0,arguments);h.id&&h.prop&&(r[h.id]=h.prop)}function g(){var h=Fe.apply(void 0,arguments);h.id&&h.prop&&(a[h.id]=_(_({},h.prop),{},{name:h.id}))}function $(h){f.use(h)}function w(){var h=Fe.apply(void 0,arguments);if(!(!h.id||!h.prop)){var m=ee(h.id),O=h.prop,T=O.merge===!0?e[m]:void 0;e[m]=_(_({},T||xt),O),u[m]=B(m),O.maker&&b(u,O.maker)}}function F(h,m){var O;if(p.String(h)){if(O=h,m===void 0)return t[O]}else O=h.displayName||h.name,m=h;!O||!m||(t[O]=m,t[ee(O)]=m,m.formCreateParser&&w(O,m.formCreateParser))}function C(){return dr(ze,t,r)}function R(h,m){var O=C();return Jt({data:function(){return ne({rule:h,option:m})},render:function(){return Kt(O,_({ref:"fc"},this.$data))}})}function P(){return Se}function D(h,m){return p.Function(h.install)?h.install(A,m):p.Function(h)&&h(A,m),this}function A(h,m){var O=R(h,m||{});o.forEach(function(de){k(function(){return de(A,O)})});var T=document.createElement("div");((m==null?void 0:m.el)||document.body).appendChild(T);var ae=O.mount(T);return ae.$refs.fc.fapi}function G(h){var m=_({},n);return h?m.inherit={components:t,parsers:e,directives:r,modelFields:i,providers:a,useApps:o,maker:u,loadData:l}:delete m.inherit,Dt(m)}function Mt(h,m){i[h]=m}function He(h){Object.keys(M).forEach(function(m){var O=Array.isArray(M[m])?M[m]:[M[m]];O.forEach(function(T){T.bus.$emit("p.loadData."+h)})})}function Nt(h,m){l[h]=m,He(h)}function Lt(h){delete l[h],He(h)}function ze(h){var m=this;b(this,{id:ri++,create:A,vm:h,manager:Kr(n.manager),parsers:e,providers:a,modelFields:i,rules:h.props.rule,name:h.props.name||Ce(),inFor:h.props.inFor,prop:{components:t,directives:r},loadData:l,CreateNode:f,bus:new pt,unwatch:null,options:qt(h.props.option||{}),extendApi:n.extendApi||function(O){return O}}),J(function(){U(m.options,function(){m.$handle.$manager.updateOptions(m.options.value),m.api().refresh()},{deep:!0})}),b(h.appContext.components,t),b(h.appContext.directives,r),this.$handle=new q(this),this.name&&(this.inFor?(M[this.name]||(M[this.name]=[]),M[this.name].push(this)):M[this.name]=this)}b(ze.prototype,{init:function(){var m=this;this.isSub()&&(this.unwatch=U(function(){return m.vm.parent.option},function(){m.initOptions(m.options.value),m.$handle.api.refresh()},{deep:!0})),this.initOptions(this.options.value),this.$handle.init()},isSub:function(){return this.vm.setupState.parent&&this.vm.props.extendOption},initOptions:function(m){this.options.value=_({formData:{},submitBtn:{},resetBtn:{}},Q(s)),this.isSub()&&(this.options.value=this.mergeOptions(this.options.value,this.vm.setupState.parent.setupState.fapi.config||{},!0)),this.updateOptions(m)},mergeOptions:function(m,O,T){return O=Q(O),T&&["page","onSubmit","mounted","reload","formData","el"].forEach(function(ae){delete O[ae]}),O.global&&(m.global=gr(m.global,O.global),delete O.global),this.$handle.$manager.mergeOptions([O],m),m},updateOptions:function(m){this.options.value=this.mergeOptions(this.options.value,m),this.$handle.$manager.updateOptions(this.options.value)},api:function(){return this.$handle.api},render:function(){return this.$handle.render()},mounted:function(){this.$handle.mounted()},unmount:function(){if(this.name)if(this.inFor){var m=M[this.name].indexOf(this);M[this.name].splice(m,1)}else delete M[this.name];this.unwatch&&this.unwatch(),this.$handle.reloadRule([])},updated:function(){var m=this;this.$handle.bindNextTick(function(){return m.bus.$emit("next-tick",m.$handle.api)})}});function Ye(h){b(h,{version:n.version,ui:n.ui,setData:Nt,removeData:Lt,maker:u,component:F,directive:v,setModelField:Mt,register:g,$vnode:P,parser:w,use:D,factory:G,componentAlias:$,copyRule:Ne,copyRules:Rt,fetch:Yr,$form:C,parseFn:fe,parseJson:vr,toJson:Ft,useApp:d,getApi:c})}function Ut(h){b(h,{create:A,install:function(O,T){if(s=_(_({},s),T||{}),O._installedFormCreate!==!0){O._installedFormCreate=!0;var ae=function(Ht){var zt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return A(Ht,zt)};Ye(ae),O.config.globalProperties.$formCreate=ae,O.component("FormCreate",C()),o.forEach(function(de){k(function(){return de(h,O)})})}}})}if(Ye(A),Ut(A),f.use({fragment:"fcFragment"}),n.install&&A.use(n),d(function(h,m){m.mixin({props:["formCreateInject"]})}),w(ei),n.inherit){var x=n.inherit;x.components&&b(t,x.components),x.parsers&&b(e,x.parsers),x.directives&&b(r,x.directives),x.modelFields&&b(i,x.modelFields),x.providers&&b(a,x.providers),x.useApps&&b(o,x.useApps),x.maker&&b(u,x.maker),x.loadData&&b(l,x.loadData)}return A}var ut={date:"YYYY-MM-DD",month:"YYYY-MM",datetime:"YYYY-MM-DD HH:mm:ss",timerange:"HH:mm:ss",daterange:"YYYY-MM-DD",monthrange:"YYYY-MM",datetimerange:"YYYY-MM-DD HH:mm:ss",year:"YYYY"},st="datePicker",ii={name:st,maker:function(){return["year","month","date","dates","week","datetime","datetimeRange","dateRange","monthRange"].reduce(function(n,t){return n[t]=B(st,{type:t.toLowerCase()}),n},{})}(),mergeProp:function(t){var e=t.prop.props;e.valueFormat||(e.valueFormat=ut[e.type]||ut.date)}},Ve="hidden",oi={name:Ve,maker:j({},Ve,function(n,t){return B(Ve)("",n,t)}),render:function(){return[]}},Re="input",ai={name:Re,maker:function(){var n=["password","url","email","text","textarea"].reduce(function(t,e){return t[e]=B(Re,{type:e}),t},{});return n.idate=B(Re,{type:"date"}),n}(),mergeProp:function(t){var e=t.prop.props;e&&e.autosize&&e.autosize.minRows&&(e.rows=e.autosize.minRows||2)}},lt="slider",ui={name:lt,maker:{sliderRange:B(lt,{range:!0})},toFormValue:function(t,e){var r=Array.isArray(t),i=e.prop.props,o=i.min||0,a;return i.range===!0?a=r?t:[o,parseFloat(t)||o]:a=r?parseFloat(t[0])||o:parseFloat(t),a}},Ee="timePicker",si={name:Ee,maker:{time:B(Ee,function(n){return n.props.isRange=!1}),timeRange:B(Ee,function(n){return n.props.isRange=!0})},mergeProp:function(t){var e=t.prop.props;e.valueFormat||(e.valueFormat="HH:mm:ss")}},li={name:"FcRow",render:function(t,e){return e.vNode.col({props:{span:24}},{default:function(){return[e.vNode.row(e.prop,t)]}})}},fi="select",ci={name:fi,toFormValue:function(t,e){return e.prop.props.multiple&&!Array.isArray(t)?L(t):t}},di=[ii,oi,ai,ui,si,li,ci],E="el",pi={button:E+"-button",icon:E+"-icon",slider:E+"-slider",rate:E+"-rate",upload:"fc-upload",cascader:E+"-cascader",popover:E+"-popover",tooltip:E+"-tooltip",colorPicker:E+"-colorPicker",timePicker:E+"-time-picker",timeSelect:E+"-time-select",datePicker:E+"-date-picker",switch:E+"-switch",select:"fc-select",checkbox:"fc-checkbox",radio:"fc-radio",inputNumber:E+"-input-number",number:E+"-input-number",input:E+"-input",formItem:E+"-form-item",form:E+"-form",frame:"fc-frame",col:E+"-col",row:E+"-row",tree:"fc-tree",autoComplete:E+"-autocomplete",auto:E+"-autocomplete",group:"fc-group",object:"fc-sub-form",subForm:"fc-sub-form"};function hi(){return{form:{inline:!1,labelPosition:"right",labelWidth:"125px",disabled:!1,size:void 0},row:{show:!0,gutter:0},submitBtn:{type:"primary",loading:!1,disabled:!1,innerText:"提交",show:!0,col:void 0,click:void 0},resetBtn:{type:"default",loading:!1,disabled:!1,innerText:"重置",show:!1,col:void 0,click:void 0}}}function mi(n){return n.type==="tooltip"}function ft(n,t){if(I(n,t)&&p.String(n[t])){var e;n[t]=(e={},j(e,t,n[t]),j(e,"show",!0),e)}}function W(n){return n===!1}function vi(n,t){I(n,t)&&!p.Object(n[t])&&(n[t]={show:!!n[t]})}function Ae(n){var t=_({},n);return delete t.children,t}var gi={validate:function(){var t=this.form();return t?t.validate():new Promise(function(e){return e()})},validateField:function(t){var e=this;return new Promise(function(r,i){var o=e.form();o?o.validateField(t,function(a){a?i(a):r(null)}):r()})},clearValidateState:function(t){var e=this.vm.refs[t.wrapRef];e&&e.clearValidate()},tidyOptions:function(t){return["submitBtn","resetBtn","row","info","wrap","col"].forEach(function(e){vi(t,e)}),t},tidyRule:function(t){var e=t.prop;return ft(e,"title"),ft(e,"info"),e},mergeProp:function(t){t.prop=X([{info:this.options.info||{},wrap:this.options.wrap||{},col:this.options.col||{}},t.prop],{info:{trigger:"hover",placement:"top-start",icon:!0},title:{},col:{span:24},wrap:{}},{normal:["title","info","col","wrap"]})},getDefaultOptions:function(){return hi()},update:function(){var t=this.options.form;this.rule={props:_({},t),on:{submit:function(r){r.preventDefault()}},class:[t.className,t.class,"form-create"],style:t.style,type:"form"}},beforeRender:function(){var t=this.key,e=this.ref,r=this.$handle;b(this.rule,{key:t,ref:e}),b(this.rule.props,{model:r.formData})},render:function(t){var e=this;return t.slotLen()&&t.setSlot(void 0,function(){return e.makeFormBtn()}),this.$r(this.rule,W(this.options.row.show)?t.getSlots():[this.makeRow(t)])},makeWrap:function(t,e){var r=this,i=t.prop,o="".concat(this.key).concat(t.key),a=i.col,u=this.isTitle(i),s=!a.labelWidth&&!u?0:a.labelWidth,l=this.rule.props,f=l.inline,c=l.col,d=W(i.wrap.show)?e:this.$r(X([i.wrap,{props:_(_({labelWidth:s===void 0?s:jt(s),label:u?i.title.title:void 0},Ae(i.wrap||{})),{},{prop:t.id,rules:i.validate}),class:i.className,key:"".concat(o,"fi"),ref:t.wrapRef,type:"formItem"}]),_({default:function(){return e}},u?{label:function(){return r.makeInfo(i,o)}}:{}));return f===!0||W(c)||W(a.show)?d:this.makeCol(i,o,[d])},isTitle:function(t){if(this.options.form.title===!1)return!1;var e=t.title;return!(!e.title&&!e.native||W(e.show))},makeInfo:function(t,e){var r=this,i=_({},t.title),o=_({},t.info),a=mi(o),u=this.options.form,s=[(i.title||"")+(u.labelSuffix||u["label-suffix"]||"")];if(!W(o.show)&&(o.info||o.native)&&!W(o.icon)){var l={type:o.type||"popover",props:Ae(o),key:"".concat(e,"pop")};delete l.props.icon,delete l.props.show,delete l.props.info,delete l.props.align,delete l.props.native;var f="content";o.info&&!I(l.props,f)&&(l.props[f]=o.info),s[o.align!=="left"?"unshift":"push"](this.$r(X([o,l]),j({},i.slot||(a?"default":"reference"),function(){return r.$r({type:"ElIcon",style:"top:2px",key:"".concat(e,"i")},{default:function(){return r.$r({type:o.icon===!0?"icon-warning":o.icon})}},!0)})))}var c=X([i,{props:Ae(i),key:"".concat(e,"tit"),type:i.type||"span"}]);return delete c.props.show,delete c.props.title,delete c.props.native,this.$r(c,s)},makeCol:function(t,e,r){var i=t.col;return this.$r({class:i.class,type:"col",props:i||{span:24},key:"".concat(e,"col")},r)},makeRow:function(t){var e=this.options.row||{};return this.$r({type:"row",props:e,class:e.class,key:"".concat(this.key,"row")},t)},makeFormBtn:function(){var t=[];if(W(this.options.submitBtn.show)||t.push(this.makeSubmitBtn()),W(this.options.resetBtn.show)||t.push(this.makeResetBtn()),!!t.length){var e=this.$r({type:"formItem",key:"".concat(this.key,"fb")},t);return this.rule.props.inline===!0?e:this.$r({type:"col",props:{span:24},key:"".concat(this.key,"fc")},[e])}},makeResetBtn:function(){var t=this,e=_({},this.options.resetBtn),r=e.innerText;return delete e.innerText,delete e.click,delete e.col,delete e.show,this.$r({type:"button",props:e,style:{width:e.width},on:{click:function(){var o=t.$handle.api;t.options.resetBtn.click?t.options.resetBtn.click(o):o.resetFields()}},key:"".concat(this.key,"b2")},[r])},makeSubmitBtn:function(){var t=this,e=_({},this.options.submitBtn),r=e.innerText;return delete e.innerText,delete e.click,delete e.col,delete e.show,this.$r({type:"button",props:e,style:{width:e.width},on:{click:function(){var o=t.$handle.api;t.options.submitBtn.click?t.options.submitBtn.click(o):o.submit().catch(function(){})}},key:"".concat(this.key,"b1")},[r])}},re={};yi(re);_i(re);bi(re);$i(re);Ci(re);function yi(n){["group","tree","switch","upload","autoComplete","checkbox","cascader","colorPicker","datePicker","frame","inputNumber","radio","rate"].forEach(function(t){n[t]=B(t)}),n.auto=n.autoComplete,n.number=n.inputNumber,n.color=n.colorPicker}function _i(n){var t="select",e="multiple";n.selectMultiple=B(t,j({},e,!0)),n.selectOne=B(t,j({},e,!1))}function bi(n){var t="tree",e={treeSelected:"selected",treeChecked:"checked"};Object.keys(e).reduce(function(r,i){return r[i]=B(t,{type:e[i]}),r},n)}function $i(n){var t="upload",e={image:["image",0],file:["file",0],uploadFileOne:["file",1],uploadImageOne:["image",1]};Object.keys(e).reduce(function(r,i){return r[i]=B(t,function(o){return o.props({uploadType:e[i][0],maxLength:e[i][1]})}),r},n),n.uploadImage=n.image,n.uploadFile=n.file}function Ci(n){var t={frameInputs:["input",0],frameFiles:["file",0],frameImages:["image",0],frameInputOne:["input",1],frameFileOne:["file",1],frameImageOne:["image",1]};return Object.keys(t).reduce(function(e,r){return e[r]=B("frame",function(i){return i.props({type:t[r][0],maxLength:t[r][1]})}),e},n),n.frameInput=n.frameInputs,n.frameFile=n.frameFiles,n.frameImage=n.frameImages,n}var wi=".form-create .form-create .el-form-item{margin-bottom:22px}.form-create{width:100%}";$e(wi);function ct(n,t){return p.Boolean(n)?n={show:n}:!p.Undef(n)&&!p.Object(n)&&(n={show:t}),n}function Oi(n,t){return b(n,{formEl:function(){return t.$manager.form()},wrapEl:function(r){var i=t.getFieldCtx(r);if(i)return t.vm.refs[i.wrapRef]},validate:function(r){return new Promise(function(i,o){var a=n.children,u=[t.$manager.validate()];a.forEach(function(s){u.push(s.validate())}),Promise.all(u).then(function(){i(!0),r&&r(!0)}).catch(function(s){o(s),r&&r(s),t.vm.emit("validate-fail",s,{api:n})})})},validateField:function(r,i){return new Promise(function(o,a){var u=t.getFieldCtx(r);if(u){var s=t.subForm[u.id],l=[t.$manager.validateField(u.id)];L(s).forEach(function(f){l.push(f.validate())}),Promise.all(l).then(function(){o(null),i&&i(null)}).catch(function(f){a(f),i&&i(f),t.vm.emit("validate-field-fail",f,{field:r,api:n})})}})},clearValidateState:function(r){var i=this,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;n.helper.tidyFields(r).forEach(function(a){o&&i.clearSubValidateState(a),t.getCtxs(a).forEach(function(u){t.$manager.clearValidateState(u)})})},clearSubValidateState:function(r){n.helper.tidyFields(r).forEach(function(i){t.getCtxs(i).forEach(function(o){var a=t.subForm[o.id];a&&(Array.isArray(a)?a.forEach(function(u){u.clearValidateState()}):a&&a.clearValidateState())})})},btn:{loading:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;n.submitBtnProps({loading:!!r})},disabled:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;n.submitBtnProps({disabled:!!r})},show:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;n.submitBtnProps({show:!!r})}},resetBtn:{loading:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;n.resetBtnProps({loading:!!r})},disabled:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;n.resetBtnProps({disabled:!!r})},show:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;n.resetBtnProps({show:!!r})}},submitBtnProps:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=ct(t.options.submitBtn,!0);b(i,r),t.options.submitBtn=i,n.refreshOptions()},resetBtnProps:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=ct(t.options.resetBtn,!1);b(i,r),t.options.resetBtn=i,n.refreshOptions()},submit:function(r,i){return new Promise(function(o,a){n.validate().then(function(){var u=n.formData();p.Function(r)&&k(function(){return r(u,n)}),p.Function(t.options.onSubmit)&&k(function(){return t.options.onSubmit(u,n)}),t.vm.emit("submit",u,n),o(u)}).catch(function(){for(var u=arguments.length,s=new Array(u),l=0;l<u;l++)s[l]=arguments[l];p.Function(i)&&k(function(){return i.apply(void 0,[n].concat(s))}),a.apply(void 0,s)})})}}),n}var Te={name:"required",load:function(t,e,r){var i=Si(t.getValue());if(i.required===!1)t.clearProp();else{var o=_({required:!0,validator:function(s,l,f){p.empty(l)?f(o.message):f()}},i);if(!o.message){var a=e.title||"";o.message=((K(a)==="object"?a.title:a)||"")+"不能为空"}t.getProp().validate=[o]}r.sync(e)},watch:function(){Te.load.apply(Te,arguments)}};function Si(n){return p.Boolean(n)?{required:n}:p.String(n)?{message:n}:p.Undef(n)?{required:!1}:p.Function(n)?{validator:n}:p.Object(n)?n:{}}function Fi(n){n.componentAlias(pi),fr.forEach(function(t){n.component(t.name,t)}),n.register(Te),di.forEach(function(t){n.parser(t)}),Object.keys(re).forEach(function(t){n.maker[t]=re[t]}),typeof window<"u"&&window.ElementPlus&&n.useApp(function(t,e){e.use(window.ElementPlus)})}function Vi(){return Dt({ui:"element-ui",version:"3.1.27",manager:gi,extendApi:Oi,install:Fi,attrs:{normal:["col","wrap"],array:["className"],key:["title","info"]}})}var Tt=Vi();typeof window<"u"&&(window.formCreate=Tt);Tt.maker;export{Tt as F};
